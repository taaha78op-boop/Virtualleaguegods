<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš½ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÚ¯ ÙÙˆØªØ¨Ø§Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&family=Lalezar&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2a1f3a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-card {
            background: rgba(20, 25, 45, 0.95);
            border-radius: 30px;
            padding: 60px 50px;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(30, 255, 0, 0.2);
            max-width: 500px;
            width: 100%;
            animation: slideUp 0.8s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .login-title {
            font-family: 'Lalezar', cursive;
            font-size: 3.5em;
            text-align: center;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .login-subtitle { text-align: center; color: #8a8a8a; margin-bottom: 40px; font-size: 1.1em; }
        .role-selector { display: flex; gap: 15px; margin-bottom: 30px; }
        .role-btn {
            flex: 1;
            padding: 18px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .role-btn:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-3px); }
        .role-btn.active {
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            border-color: #1eff00;
            color: #0a0e27;
            box-shadow: 0 10px 40px rgba(30, 255, 0, 0.4);
        }
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; margin-bottom: 10px; color: #b0b0b0; font-weight: 500; }
        .input-group input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-family: 'Vazirmatn', sans-serif;
            transition: all 0.3s;
        }
        .input-group input:focus {
            outline: none;
            border-color: #1eff00;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 30px rgba(30, 255, 0, 0.2);
        }
        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            border: none;
            border-radius: 12px;
            color: #0a0e27;
            font-weight: 700;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 50px rgba(30, 255, 0, 0.5); }
        .team-select-btn {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-align: right;
        }
        .team-select-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(30, 255, 0, 0.3);
        }
        .team-select-btn.selected {
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            border-color: #1eff00;
            color: #0a0e27;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(30, 255, 0, 0.3);
        }
        .header {
            background: rgba(20, 25, 45, 0.95);
            padding: 25px 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(30, 255, 0, 0.2);
        }
        .header-title {
            font-family: 'Lalezar', cursive;
            font-size: 2.2em;
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .logout-btn {
            padding: 12px 25px;
            background: rgba(255, 50, 50, 0.2);
            border: 2px solid rgba(255, 50, 50, 0.4);
            border-radius: 10px;
            color: #ff5050;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .logout-btn:hover { background: rgba(255, 50, 50, 0.3); }
        .nav-tabs { display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .nav-tab {
            padding: 15px 30px;
            background: rgba(20, 25, 45, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #b0b0b0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .nav-tab:hover { background: rgba(255, 255, 255, 0.05); color: #fff; }
        .nav-tab.active {
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            border-color: #1eff00;
            color: #0a0e27;
        }
        .card {
            background: rgba(20, 25, 45, 0.9);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-title { font-size: 1.8em; font-weight: 700; margin-bottom: 25px; color: #1eff00; font-family: 'Lalezar', cursive; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #b0b0b0; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-family: 'Vazirmatn', sans-serif;
            transition: all 0.3s;
        }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #1eff00;
            background: rgba(255, 255, 255, 0.08);
        }
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #1eff00 0%, #00ff88 100%);
            border: none;
            border-radius: 10px;
            color: #0a0e27;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(30, 255, 0, 0.4); }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .btn-danger {
            background: rgba(255, 50, 50, 0.2);
            color: #ff5050;
            border: 2px solid rgba(255, 50, 50, 0.4);
        }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th, .data-table td { padding: 15px; text-align: center; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .data-table th { background: rgba(30, 255, 0, 0.1); color: #1eff00; font-weight: 600; }
        .data-table tr:hover { background: rgba(255, 255, 255, 0.05); }
        .player-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        .player-card:hover { background: rgba(255, 255, 255, 0.08); transform: translateX(-5px); }
        .player-name { font-size: 1.2em; font-weight: 600; color: #fff; margin-bottom: 5px; }
        .player-details { color: #b0b0b0; font-size: 0.95em; }
        .player-overall {
            font-size: 2em;
            font-weight: 700;
            color: #1eff00;
            background: rgba(30, 255, 0, 0.1);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .match-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .team-name { font-weight: 600; font-size: 1.1em; }
        .match-score {
            font-size: 1.8em;
            font-weight: 700;
            color: #1eff00;
            background: rgba(30, 255, 0, 0.1);
            padding: 10px 25px;
            border-radius: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .stat-box {
            background: rgba(30, 255, 0, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid rgba(30, 255, 0, 0.2);
        }
        .stat-value { font-size: 2.5em; font-weight: 700; color: #1eff00; margin-bottom: 10px; }
        .stat-label { color: #b0b0b0; font-size: 0.95em; }
        .transfer-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .transfer-image { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; }
        .transfer-player { font-size: 1.2em; font-weight: 600; margin-bottom: 5px; }
        .transfer-route { color: #1eff00; margin-bottom: 5px; }
        .transfer-price { color: #b0b0b0; font-size: 0.95em; }
        .notification-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-right: 4px solid #1eff00;
        }
        .notification-time { color: #b0b0b0; font-size: 0.85em; margin-top: 5px; }
        .action-btns { display: flex; gap: 10px; margin-top: 15px; }
        .pending-badge {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .chat-container {
            background: rgba(20, 25, 45, 0.9);
            border-radius: 20px;
            padding: 25px;
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }
        .chat-message {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chat-message.user {
            background: rgba(30, 255, 0, 0.1);
            border-color: rgba(30, 255, 0, 0.3);
            margin-left: 50px;
        }
        .chat-message.ai {
            background: rgba(0, 150, 255, 0.1);
            border-color: rgba(0, 150, 255, 0.3);
            margin-right: 50px;
        }
        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-family: 'Vazirmatn', sans-serif;
        }
        .settings-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .settings-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #1eff00;
            margin-bottom: 20px;
        }
        .color-picker-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .position-control {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        .position-input {
            width: 80px;
        }
        .pitch-container {
            background: linear-gradient(to bottom, #2d5016 0%, #2d5016 50%, #3d6020 50%, #3d6020 100%);
            border: 3px solid #fff;
            border-radius: 10px;
            position: relative;
            width: 100%;
            max-width: 700px;
            height: 500px;
            margin: 20px auto;
            overflow: hidden;
        }
        .pitch-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .center-circle {
            position: absolute;
            width: 120px;
            height: 120px;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .center-spot {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .halfway-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.5);
            top: 50%;
            transform: translateY(-50%);
        }
        .penalty-box {
            position: absolute;
            width: 50%;
            height: 30%;
            border: 2px solid rgba(255,255,255,0.5);
            left: 50%;
            transform: translateX(-50%);
        }
        .penalty-box.top { top: 0; }
        .penalty-box.bottom { bottom: 0; }
        .player-slot {
            position: absolute;
            width: 60px;
            height: 70px;
            background: rgba(30, 255, 0, 0.2);
            border: 2px solid #1eff00;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            transform: translate(-50%, -50%);
        }
        .player-slot:hover {
            background: rgba(30, 255, 0, 0.4);
            transform: translate(-50%, -50%) scale(1.1);
        }
        .player-slot.filled {
            background: rgba(30, 255, 0, 0.3);
            border-color: #1eff00;
        }
        .player-slot.empty {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            border-style: dashed;
        }
        .player-number {
            font-size: 1.2em;
            font-weight: 700;
            color: #1eff00;
        }
        .player-short-name {
            font-size: 0.7em;
            color: #fff;
            text-align: center;
            margin-top: 2px;
            max-width: 55px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .formation-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .formation-btn {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .formation-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .formation-btn.active {
            background: rgba(30, 255, 0, 0.2);
            border-color: #1eff00;
            color: #1eff00;
        }
        .player-list-selector {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        .player-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .player-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #1eff00;
        }
        .player-item.selected {
            background: rgba(30, 255, 0, 0.2);
            border-color: #1eff00;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: rgba(20, 25, 45, 0.98);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid #1eff00;
        }
        .modal-header {
            font-size: 1.5em;
            font-weight: 700;
            color: #1eff00;
            margin-bottom: 20px;
        }
        .modal-close {
            background: rgba(255, 50, 50, 0.2);
            border: 2px solid rgba(255, 50, 50, 0.4);
            color: #ff5050;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const app = {
            user: null,
            role: null,
            team: null,
            teams: [],
            players: [],
            matches: [],
            budgets: [],
            transfers: [],
            news: [],
            bets: [],
            notifications: [],
            userTeams: {},
            pendingPlayers: [],
            pendingTransfers: [],
            lineups: {},
            schedule: [],
            leagueType: 'league',
            settings: {
                buttonColor: '#1eff00',
                buttonSecondColor: '#00ff88',
                buttonPositions: {},
                bgImage: '',
                bgColor1: '#0a0e27',
                bgColor2: '#2a1f3a',
                logoImage: '',
                leagueName: 'Ù„ÛŒÚ¯ ÙÙˆØªØ¨Ø§Ù„'
            }
        };

        // Storage Configuration - ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ùˆ Ø±ÙˆØ´ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
        const STORAGE_TYPE ='jsonbin'
        
        // GitHub Gist Configuration (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        const GIST_ID = '';
        const GITHUB_TOKEN = '';
        
        // JSONBin Configuration (Ø³Ø§Ø¯Ù‡â€ŒØªØ± - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)
        const JSONBIN_ID = '698da9c5d0ea881f40b4930a';
        const JSONBIN_KEY = '$2a$10$mFtitb.iHP4TG9XMcEMVcOleX1B/lik6tUr7oM7QU6S9xDHlrHJ7i';
        
        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ fetch Ø¨Ø§ timeout
        function fetchWithTimeout(url, options = {}, timeoutMs = 5000) {
            return new Promise((resolve, reject) => {
                const controller = typeof AbortController !== 'undefined' ? new AbortController() : null;
                const timer = setTimeout(() => {
                    if (controller) controller.abort();
                    reject(new Error('timeout'));
                }, timeoutMs);
                const fetchOptions = controller ? { ...options, signal: controller.signal } : options;
                fetch(url, fetchOptions)
                    .then(res => { clearTimeout(timer); resolve(res); })
                    .catch(err => { clearTimeout(timer); reject(err); });
            });
        }

        async function loadData() {
            let dataLoaded = false;
            
            // Ø§Ø¨ØªØ¯Ø§ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø§Ø² Ø³Ø±ÙˆØ± Ø¨Ø®ÙˆØ§Ù†ÛŒÙ… (Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ Ø³Ø±ÙˆØ±)
            try {
                if (STORAGE_TYPE === 'github' && typeof GIST_ID !== 'undefined' && GIST_ID && GIST_ID !== 'YOUR_GIST_ID_HERE') {
                    const response = await fetchWithTimeout(`https://api.github.com/gists/${GIST_ID}`, {}, 10000);
                    if (response.ok) {
                        const gist = await response.json();
                        const content = gist.files['data.json'].content;
                        const data = JSON.parse(content);
                        Object.assign(app, data);
                        localStorage.setItem('footballLeagueData', JSON.stringify(app));
                        dataLoaded = true;
                        console.log('âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² GitHub Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                    }
                } else if (STORAGE_TYPE === 'jsonbin' && JSONBIN_ID && JSONBIN_ID !== 'YOUR_JSONBIN_ID_HERE') {
                    const response = await fetchWithTimeout(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
                        headers: { 'X-Master-Key': JSONBIN_KEY }
                    }, 10000);
                    if (response.ok) {
                        const result = await response.json();
                        Object.assign(app, result.record);
                        localStorage.setItem('footballLeagueData', JSON.stringify(app));
                        dataLoaded = true;
                        console.log('âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² JSONBin Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                    }
                }
            } catch (error) {
                console.warn('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ø³Ø±ÙˆØ± Ù…Ù…Ú©Ù† Ù†Ø´Ø¯ØŒ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø§Ø² localStorage Ø¨Ø®ÙˆØ§Ù†ÛŒÙ…:', error.message);
            }

            // Ø§Ú¯Ø± Ø§Ø² Ø³Ø±ÙˆØ± Ù†ØªÙˆØ§Ù†Ø³ØªÛŒÙ… Ø¨Ø®ÙˆØ§Ù†ÛŒÙ…ØŒ Ø§Ø² localStorage Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†ÛŒÙ…
            if (!dataLoaded) {
                try {
                    const saved = localStorage.getItem('footballLeagueData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        Object.assign(app, data);
                        console.log('âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² localStorage Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                    }
                } catch (e) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† localStorage:', e);
                }
            }
        }

        
        // ----- Ø´Ø±ÙˆØ¹ ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±ÙˆÙ‡ÛŒ (Ø§Ø¶Ø§ÙÙ‡â€ŒØ´Ø¯Ù‡ Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª) -----
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        function runGroupDraw() {
            const leagueTeams = app.teams.filter(t => t.name !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ').map(t => t.name);
            const groupsCount = parseInt(document.getElementById('groupsCount').value) || 1;
            if (groupsCount < 1) { alert('ØªØ¹Ø¯Ø§Ø¯ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 1 Ø¨Ø§Ø´Ø¯'); return; }
            // Shuffle teams and distribute into groups
            const teams = [...leagueTeams];
            shuffleArray(teams);
            const groups = {};

            for (let i = 0; i < groupsCount; i++) groups['Ú¯Ø±ÙˆÙ‡ ' + (i+1)] = [];

            let idx = 0;
            while (teams.length) {
                const g = 'Ú¯Ø±ÙˆÙ‡ ' + ((idx % groupsCount) + 1);
                groups[g].push(teams.shift());
                idx++;
            }

            app.groups = groups;
            saveData();
            // display groups
            const groupsArea = document.getElementById('groupsArea');
            groupsArea.innerHTML = Object.keys(groups).map(g => `<div style="margin-bottom:10px;"><strong>${g}:</strong> ${groups[g].join('ØŒ ')}</div>`).join('');
            alert('âœ… Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯');
        }

        function advanceFromGroups() {
            const advancePerGroup = parseInt(document.getElementById('advancePerGroup').value) || 2;
            if (!app.groups) { alert('Ø§Ø¨ØªØ¯Ø§ Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯'); return; }
            // For each group pick top N by current points (app.teams), fallback to goal diff then random
            const advancers = [];
            Object.keys(app.groups).forEach(g => {
                const teams = app.groups[g];
                const sorted = teams.map(name => {
                    const t = app.teams.find(x => x.name === name) || { name, p:0, gf:0, ga:0 };
                    return { name: t.name, p: t.p || 0, gd: (t.gf||0) - (t.ga||0) };
                }).sort((a,b) => b.p - a.p || b.gd - a.gd);
                // if tie and not enough distinct, fill with random selection among tied teams
                const selected = sorted.slice(0, advancePerGroup).map(s => s.name);
                advancers.push(...selected);
            });
            app.groupAdvancers = advancers;
            saveData();
            alert('âœ… ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ ØµØ¹ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡ Ø«Ø¨Øª Ø´Ø¯Ù†Ø¯:\n' + advancers.join('ØŒ '));
        }
        // ----- Ù¾Ø§ÛŒØ§Ù† ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±ÙˆÙ‡ÛŒ -----

    async function saveData() {
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            try {
                localStorage.setItem('footballLeagueData', JSON.stringify(app));
                console.log('âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
            } catch(e) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ localStorage:', e);
                alert('âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ù„ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø³Ø±ÙˆØ± (Ø¯Ø± ØµÙˆØ±Øª Ø§Ù…Ú©Ø§Ù†)
            let serverSaved = false;
            try {
                if (STORAGE_TYPE === 'github' && GIST_ID && GIST_ID !== 'YOUR_GIST_ID_HERE' && GITHUB_TOKEN && GITHUB_TOKEN !== 'YOUR_GITHUB_TOKEN_HERE') {
                    const response = await fetchWithTimeout(`https://api.github.com/gists/${GIST_ID}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            files: {
                                'data.json': {
                                    content: JSON.stringify(app, null, 2)
                                }
                            }
                        })
                    }, 10000);
                    if (response.ok) {
                        serverSaved = true;
                        console.log('âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± GitHub Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    }
                } else if (STORAGE_TYPE === 'jsonbin' && JSONBIN_ID && JSONBIN_ID !== 'YOUR_JSONBIN_ID_HERE' && JSONBIN_KEY && JSONBIN_KEY !== 'YOUR_JSONBIN_KEY_HERE') {
                    const response = await fetchWithTimeout(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': JSONBIN_KEY
                        },
                        body: JSON.stringify(app)
                    }, 10000);
                    if (response.ok) {
                        serverSaved = true;
                        console.log('âœ“ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± JSONBin Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    }
                }
            } catch (error) {
                console.warn('Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø³Ø±ÙˆØ± Ù…Ù…Ú©Ù† Ù†Ø´Ø¯ - ÙÙ‚Ø· Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯:', error.message);
            }
            
            return serverSaved;
        }

        loadData().then(() => {
            // ØªÛŒÙ… Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ Ø±Ø§ Ø¨Ø³Ø§Ø² Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
            if (!app.teams.find(t => t.name === 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ')) {
                // ÙÙ‚Ø· Ø¯Ø± userTeams Ø«Ø¨Øª Ú©Ù† Ù†Ù‡ teams (Ø¬Ø¯ÙˆÙ„)
                if (!app.userTeams['Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ']) {
                    app.userTeams['Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ'] = { name: 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ', username: 'free', password: 'free123', isFreeTeam: true };
                    app.budgets.push({ team: 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ', budget: 999999999 });
                    saveData();
                }
            }
            applyStoredSettings();
            // Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª: Ù‡Ø± Ø¨Ø§Ø± Ú©Ù‡ Ú©Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ø³Ø§ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ Ø¨Ø§Ø² Ø´ÙˆØ¯
            app.user = null;
            renderApp();
        }).catch(() => {
            // Ø­ØªÛŒ Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¨ÙˆØ¯ØŒ ØµÙØ­Ù‡ Ø¨Ø§Ø² Ø´ÙˆØ¯
            applyStoredSettings();
            app.user = null;
            renderApp();
        });

        function applyStoredSettings() {
            if (app.settings.bgImage) {
                document.body.style.backgroundImage = `url('${app.settings.bgImage}')`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundPosition = 'center';
            } else if (app.settings.bgColor1 && app.settings.bgColor2) {
                document.body.style.background = `linear-gradient(135deg, ${app.settings.bgColor1} 0%, ${app.settings.bgColor2} 100%)`;
            }
        }

        function renderApp() {
            const root = document.getElementById('app');
            
            if (!app.user) {
                renderLogin(root);
            } else if (app.role === 'admin') {
                renderAdmin(root);
            } else if (app.role === 'team') {
                renderTeam(root);
            } else {
                renderViewer(root);
            }
        }

        function renderLogin(root) {
            const logoHtml = app.settings.logoImage ? 
                `<img src="${app.settings.logoImage}" style="width:100px;height:100px;object-fit:contain;margin:0 auto 15px;display:block;border-radius:50%;" alt="Ù„ÙˆÚ¯Ùˆ">` : 
                `<div style="font-size:4em;text-align:center;margin-bottom:10px;">âš½</div>`;
            root.innerHTML = `
                <div class="login-screen">
                    <div class="login-card">
                        ${logoHtml}
                        <h1 class="login-title">${app.settings.leagueName || 'Ù„ÛŒÚ¯ ÙÙˆØªØ¨Ø§Ù„'}</h1>
                        <p class="login-subtitle">Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù„ÛŒÚ¯ ÙÙˆØªØ¨Ø§Ù„</p>
                        
                        <div class="role-selector">
                            <div class="role-btn ${app.role === 'admin' ? 'active' : ''}" onclick="selectRole('admin', event)">Ù…Ø¯ÛŒØ±</div>
                            <div class="role-btn ${app.role === 'team' ? 'active' : ''}" onclick="selectRole('team', event)">ØªÛŒÙ…</div>
                            <div class="role-btn ${app.role === 'viewer' ? 'active' : ''}" onclick="selectRole('viewer', event)">Ø±ÙˆØ­</div>
                        </div>
                        
                        <div id="loginFields"></div>
                        
                        <button class="login-btn" type="button" onclick="login()">ÙˆØ±ÙˆØ¯</button>
                    </div>
                </div>
            `;
            
            updateLoginFields();
        }

        function selectRole(role, e) {
            app.role = role;
            const evt = e || window.event;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            if (evt && evt.target) {
                evt.target.classList.add('active');
            }
            updateLoginFields();
        }

        function updateLoginFields() {
            const container = document.getElementById('loginFields');
            if (!container) return;
            
            if (app.role === 'viewer') {
                container.innerHTML = `
                    <p style="text-align: center; color: #1eff00; margin: 20px 0;">
                        ÙˆØ±ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ø­Ø§Ù„Øª ØªÙ…Ø§Ø´Ø§Ú¯Ø±
                    </p>
                `;
            } else if (app.role === 'team') {
                // ØªÛŒÙ… Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª ÙˆØ±ÙˆØ¯ ØªÛŒÙ…â€ŒÙ‡Ø§ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´Ù‡
                const teams = Object.keys(app.userTeams).filter(k => !app.userTeams[k].isFreeTeam);
                container.innerHTML = `
                    <div class="input-group">
                        <label>Ø§Ù†ØªØ®Ø§Ø¨ ØªÛŒÙ…</label>
                        <div id="teamsList" style="display:flex; flex-direction:column; gap:10px; max-height:300px; overflow-y:auto; padding-left:4px;">
                            ${teams.length === 0 ? '<p style="color:#b0b0b0; text-align:center;">Ù‡ÛŒÚ† ØªÛŒÙ…ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>' : 
                                teams.map(teamKey => {
                                    const team = app.userTeams[teamKey];
                                    return `
                                        <button type="button" class="team-select-btn" data-team="${team.name}" onclick="selectTeam('${team.name}')">
                                            ${team.name}
                                        </button>
                                    `;
                                }).join('')
                            }
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                        <input type="password" id="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="input-group">
                        <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                        <input type="text" id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-group">
                        <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                        <input type="password" id="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                `;
            }
        }

        function selectTeam(teamName) {
            document.querySelectorAll('.team-select-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            app.selectedTeam = teamName;
        }

        function login() {
            if (app.role === 'viewer') {
                app.user = 'viewer';
                app.team = null;
                renderApp();
                return;
            }

            const password = document.getElementById('password').value.trim();
            
            if (!password) {
                alert('Ù„Ø·ÙØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            if (app.role === 'admin') {
                const username = document.getElementById('username').value.trim();
                if (!username) {
                    alert('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    return;
                }
                if (username === 'admin' && password === 'admin123') {
                    app.user = username;
                    renderApp();
                } else {
                    alert('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                }
            } else if (app.role === 'team') {
                if (!app.selectedTeam) {
                    alert('Ù„Ø·ÙØ§ ÛŒÚ© ØªÛŒÙ… Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                    return;
                }
                
                const teamKey = Object.keys(app.userTeams).find(t => app.userTeams[t].name === app.selectedTeam);
                const team = app.userTeams[teamKey];
                
                if (team && team.password === password) {
                    app.user = team.username;
                    app.team = team.name;
                    renderApp();
                } else {
                    alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                }
            }
        }

        function logout() {
            app.user = null;
            app.role = null;
            app.team = null;
            renderApp();
        }

        async function manualSave() {
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...';
            btn.disabled = true;
            
            try {
                const saved = await saveData();
                if (saved) {
                    btn.innerHTML = 'âœ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 2000);
                } else {
                    btn.innerHTML = 'âš ï¸ ÙÙ‚Ø· Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 3000);
                }
            } catch (e) {
                btn.innerHTML = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        }

        async function refreshData() {
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...';
            btn.disabled = true;
            
            try {
                await loadData();
                btn.innerHTML = 'âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    renderApp();
                }, 1000);
            } catch (e) {
                btn.innerHTML = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        }

        function renderAdmin(root) {
            const logoHtml = app.settings.logoImage ? 
                `<img src="${app.settings.logoImage}" style="width:50px;height:50px;object-fit:contain;border-radius:50%;margin-left:10px;" alt="Ù„ÙˆÚ¯Ùˆ">` : '';
            const pendingTrCount = (app.pendingTransfers || []).filter(t => t.status === 'pending').length;
            root.innerHTML = `
                <div class="container">
                    <div class="header">
                        <h1 class="header-title">${logoHtml}âš½ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÚ¯</h1>
                        <div class="user-info">
                            <button class="btn" onclick="refreshData()" style="margin-left: 15px; padding: 10px 20px;">ğŸ”„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯</button>
                            <button class="btn" onclick="manualSave()" style="margin-left: 15px; padding: 10px 20px;">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
                            <span>Ù…Ø¯ÛŒØ±: ${app.user}</span>
                            <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </div>
                    
                    <div class="nav-tabs">
                        <div class="nav-tab active" onclick="showTab('teams')">ØªÛŒÙ…â€ŒÙ‡Ø§</div>
                        <div class="nav-tab" onclick="showTab('players')">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</div>
                        <div class="nav-tab" onclick="showTab('matches')">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
                        <div class="nav-tab" onclick="showTab('schedule')">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÙ‡â€ŒÙ‡Ø§</div>
                        <div class="nav-tab" onclick="showTab('standings')">Ø¬Ø¯ÙˆÙ„</div>
                        <div class="nav-tab" onclick="showTab('budget')">Ø¨ÙˆØ¯Ø¬Ù‡</div>
                        <div class="nav-tab" onclick="showTab('transfers')">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</div>
                        <div class="nav-tab" onclick="showTab('pendingtransfers')">Ù†Ù‚Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ${pendingTrCount > 0 ? `<span class="pending-badge">${pendingTrCount}</span>` : ''}</div>
                        
                        <div class="nav-tab" onclick="showTab('notifications')">Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ ${app.notifications.length > 0 ? `<span class="pending-badge">${app.notifications.length}</span>` : ''}</div>
                        <div class="nav-tab" onclick="showTab('settings')">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</div>
                    </div>
                    
                    <div id="content"></div>
                </div>
            `;
            
            showTab('teams');
        }

        function renderTeam(root) {
            root.innerHTML = `
                <div class="container">
                    <div class="header">
                        <h1 class="header-title">âš½ Ù¾Ù†Ù„ ØªÛŒÙ…</h1>
                        <div class="user-info">
                            <button class="btn" onclick="refreshData()" style="margin-left: 15px; padding: 10px 20px;">ğŸ”„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯</button>
                            <span>ØªÛŒÙ…: ${app.team}</span>
                            <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </div>
                    
                    <div class="nav-tabs">
                        <div class="nav-tab active" onclick="showTeamTab('myteam')">ØªÛŒÙ… Ù…Ù†</div>
                        <div class="nav-tab" onclick="showTeamTab('lineup')">ØªØ±Ú©ÛŒØ¨ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</div>
                        <div class="nav-tab" onclick="showTeamTab('standings')">Ø¬Ø¯ÙˆÙ„</div>
                        <div class="nav-tab" onclick="showTeamTab('matches')">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
                        <div class="nav-tab" onclick="showTeamTab('budget')">Ø¨ÙˆØ¯Ø¬Ù‡</div>
                        <div class="nav-tab" onclick="showTeamTab('transfers')">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</div>
                        <div class="nav-tab" onclick="showTeamTab('betting')">Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ</div>
                        <div class="nav-tab" onclick="showTeamTab('assistant')">Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯</div>
                    </div>
                    
                    <div id="content"></div>
                </div>
            `;
            
            showTeamTab('myteam');
        }

        function renderViewer(root) {
            root.innerHTML = `
                <div class="container">
                    <div class="header">
                        <h1 class="header-title">âš½ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒÚ¯</h1>
                        <div class="user-info">
                            <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </div>
                    
                    <div class="nav-tabs">
                        <div class="nav-tab active" onclick="showViewerTab('standings')">Ø¬Ø¯ÙˆÙ„</div>
                        <div class="nav-tab" onclick="showViewerTab('matches')">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
                        <div class="nav-tab" onclick="showViewerTab('stats')">Ø¢Ù…Ø§Ø±</div>
                    </div>
                    
                    <div id="content"></div>
                </div>
            `;
            
            showViewerTab('standings');
        }

        function showTab(tab) {
            const evt = window.event;
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            if (evt && evt.target) {
                evt.target.classList.add('active');
            }
            
            const content = document.getElementById('content');
            
            switch(tab) {
                case 'teams': renderTeamsManager(content); break;
                case 'players': renderPlayersManager(content); break;
                case 'matches': renderMatchesManager(content); break;
                case 'schedule': renderScheduleManager(content); break;
                case 'standings': renderStandings(content); break;
                case 'budget': renderBudgetManager(content); break;
                case 'transfers': renderTransfersManager(content); break;
                case 'pendingtransfers': renderPendingTransfersManager(content); break;
                case 'notifications': renderNotifications(content); break;
                case 'settings': renderSettings(content); break;
            }
        }

        function showTeamTab(tab) {
            const evt = window.event;
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            if (evt && evt.target) {
                evt.target.classList.add('active');
            }
            
            const content = document.getElementById('content');
            
            switch(tab) {
                case 'myteam': renderMyTeam(content); break;
                case 'lineup': renderLineupEditor(content); break;
                case 'standings': renderStandings(content); break;
                case 'matches': renderMatchesView(content); break;
                case 'budget': renderBudgetView(content); break;
                case 'transfers': renderTransfersView(content); break;
                case 'betting': renderBettingView(content); break;
                case 'assistant': renderAIAssistant(content); break;
            }
        }

        function showViewerTab(tab) {
            const evt = window.event;
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            if (evt && evt.target) {
                evt.target.classList.add('active');
            }
            
            const content = document.getElementById('content');
            
            switch(tab) {
                case 'standings': renderStandings(content); break;
                case 'matches': renderMatchesView(content); break;
                case 'stats': renderStats(content); break;
            }
        }

        function renderTeamsManager(c) {
            // ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù‡Ø³ØªÙ†Ø¯ (Ø¨Ø¯ÙˆÙ† Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ)
            const leagueTeams = app.teams.filter(t => t.name !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ');
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÛŒØ¹ ØªÛŒÙ…â€ŒÙ‡Ø§</h2>
                    <button class="btn" onclick="createSampleTeams()">ğŸš€ Ø³Ø§Ø®Øª Û´ ØªÛŒÙ… Ù†Ù…ÙˆÙ†Ù‡</button>
                    <p style="color:#b0b0b0;margin-top:10px;font-size:0.9em;">Ø¨Ø§ ÛŒÚ© Ú©Ù„ÛŒÚ© Û´ ØªÛŒÙ… Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† ØªÛŒÙ… Ø¬Ø¯ÛŒØ¯</h2>
                    <div class="form-row">
                        <div class="form-group"><label>Ù†Ø§Ù… ØªÛŒÙ…</label><input type="text" id="teamName"></div>
                        <div class="form-group"><label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label><input type="text" id="teamUser"></div>
                        <div class="form-group"><label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label><input type="password" id="teamPass"></div>
                    </div>
                    <button class="btn" onclick="addTeam()">Ø§ÙØ²ÙˆØ¯Ù† ØªÛŒÙ…</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ (Ø¯Ø± Ø¬Ø¯ÙˆÙ„)</h2>
                    ${leagueTeams.length === 0 ? '<p style="color:#b0b0b0;">ØªÛŒÙ…ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : `
                        <table class="data-table">
                            <thead><tr><th>ØªÛŒÙ…</th><th>Ø¨Ø§Ø²ÛŒ</th><th>Ø¨Ø±Ø¯</th><th>Ù…Ø³Ø§ÙˆÛŒ</th><th>Ø¨Ø§Ø®Øª</th><th>Ú¯Ù„ Ø²Ø¯Ù‡</th><th>Ú¯Ù„ Ø®ÙˆØ±Ø¯Ù‡</th><th>Ø§Ù…ØªÛŒØ§Ø²</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead>
                            <tbody>${leagueTeams.map(t => `
                                <tr>
                                    <td style="font-weight:600;">${t.name}</td>
                                    <td>${t.w + t.d + t.l}</td>
                                    <td>${t.w}</td>
                                    <td>${t.d}</td>
                                    <td>${t.l}</td>
                                    <td>${t.gf}</td>
                                    <td>${t.ga}</td>
                                    <td style="color:#1eff00;font-weight:700;">${t.p}</td>
                                    <td>
                                        <button class="btn btn-secondary" onclick="editTeam('${t.name}')" style="margin-left: 5px;">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                        <button class="btn btn-danger" onclick="deleteTeam('${t.name}')">Ø­Ø°Ù</button>
                                    </td>
                                </tr>
                            `).join('')}</tbody>
                        </table>
                    `}
                </div>
                
                <div class="card" style="border-color:rgba(255,165,0,0.3);">
                    <h2 class="card-title" style="color:#ffa500;">ğŸŒ ØªÛŒÙ… Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ</h2>
                    <p style="color:#b0b0b0;margin-bottom:15px;">Ø§ÛŒÙ† ØªÛŒÙ… Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ùˆ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø­Ø¶ÙˆØ± Ù†Ø¯Ø§Ø±Ø¯. ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒÚ©Ù† Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                    <p style="color:#888;">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¢Ø²Ø§Ø¯: ${app.players.filter(p => p.team === 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ').length} Ù†ÙØ±</p>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ ${app.pendingPlayers.length > 0 ? `<span class="pending-badge">${app.pendingPlayers.length}</span>` : ''}</h2>
                    ${app.pendingPlayers.length === 0 ? '<p style="color:#b0b0b0;">Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù†ÛŒØ³Øª</p>' : app.pendingPlayers.map(p => `
                        <div class="player-card">
                            <div class="player-info">
                                <div class="player-name">${p.name}</div>
                                <div class="player-details">${p.position} â€¢ ${p.team} â€¢ Overall: ${p.overall}</div>
                            </div>
                            <div class="action-btns">
                                <button class="btn" onclick="approvePlayer(${p.id})">ØªØ§ÛŒÛŒØ¯</button>
                                <button class="btn btn-danger" onclick="rejectPlayer(${p.id})">Ø±Ø¯</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function createSampleTeams() {
            if (app.teams.length > 0) {
                if (!confirm('ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯. Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ØŸ')) return;
            }

            const sampleTeams = [
                { name: 'Ù¾Ø±Ø³Ù¾ÙˆÙ„ÛŒØ³', username: 'perspolis', password: '1234' },
                { name: 'Ø§Ø³ØªÙ‚Ù„Ø§Ù„', username: 'esteghlal', password: '1234' },
                { name: 'Ø³Ù¾Ø§Ù‡Ø§Ù†', username: 'sepahan', password: '1234' },
                { name: 'ØªØ±Ø§Ú©ØªÙˆØ±', username: 'tractor', password: '1234' }
            ];

            sampleTeams.forEach(team => {
                if (!app.teams.find(t => t.name === team.name)) {
                    app.teams.push({ name: team.name, w: 0, d: 0, l: 0, gf: 0, ga: 0, p: 0 });
                    app.userTeams[team.name] = team;
                    app.budgets.push({ team: team.name, budget: 50000000 });
                }
            });

            saveData();
            alert('âœ… Û´ ØªÛŒÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!\n\nØ§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯:\nâ€¢ Ù¾Ø±Ø³Ù¾ÙˆÙ„ÛŒØ³: perspolis / 1234\nâ€¢ Ø§Ø³ØªÙ‚Ù„Ø§Ù„: esteghlal / 1234\nâ€¢ Ø³Ù¾Ø§Ù‡Ø§Ù†: sepahan / 1234\nâ€¢ ØªØ±Ø§Ú©ØªÙˆØ±: tractor / 1234');
            showTab('teams');
        }

        function addTeam() {
            const name = document.getElementById('teamName').value.trim();
            const username = document.getElementById('teamUser').value.trim();
            const password = document.getElementById('teamPass').value.trim();
            
            if (!name || !username || !password) {
                alert('Ù„Ø·ÙØ§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }
            
            if (name === 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ') {
                alert('Ø§ÛŒÙ† Ù†Ø§Ù… Ø±Ø²Ø±Ùˆ Ø´Ø¯Ù‡ Ø§Ø³Øª');
                return;
            }
            
            if (app.teams.find(t => t.name === name)) {
                alert('ØªÛŒÙ… Ø¨Ø§ Ø§ÛŒÙ† Ù†Ø§Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯');
                return;
            }
            
            app.teams.push({ name, w: 0, d: 0, l: 0, gf: 0, ga: 0, p: 0 });
            app.userTeams[name] = { name, username, password };
            app.budgets.push({ team: name, budget: 50000000 });
            
            saveData();
            showTab('teams');
        }

        function editTeam(oldName) {
            const team = app.teams.find(t => t.name === oldName);
            if (!team) return;
            
            const userTeam = app.userTeams[oldName];
            
            const newName = prompt('Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯ ØªÛŒÙ…:', oldName);
            if (newName && newName.trim() !== '' && newName !== oldName) {
                // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† Ù†Ø§Ù…
                if (app.teams.find(t => t.name === newName)) {
                    alert('Ø§ÛŒÙ† Ù†Ø§Ù… Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª');
                    return;
                }
                
                // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± ØªÛŒÙ…â€ŒÙ‡Ø§
                team.name = newName;
                
                // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± userTeams
                if (userTeam) {
                    app.userTeams[newName] = { ...userTeam, name: newName };
                    delete app.userTeams[oldName];
                }
                
                // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†
                app.players.forEach(p => {
                    if (p.team === oldName) p.team = newName;
                });
                
                // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± Ø¨ÙˆØ¯Ø¬Ù‡
                const budget = app.budgets.find(b => b.team === oldName);
                if (budget) budget.team = newName;
                
                // ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø¯Ø± ØªØ±Ú©ÛŒØ¨â€ŒÙ‡Ø§
                if (app.lineups[oldName]) {
                    app.lineups[newName] = app.lineups[oldName];
                    delete app.lineups[oldName];
                }
            }
            
            if (userTeam) {
                const newPassword = prompt('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ (Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¹Ø¯Ù… ØªØºÛŒÛŒØ±):', '');
                if (newPassword && newPassword.trim() !== '') {
                    app.userTeams[newName || oldName].password = newPassword.trim();
                }
            }
            
            saveData();
            showTab('teams');
        }

        function deleteTeam(name) {
            if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ØªÛŒÙ… ${name} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) return;
            
            app.teams = app.teams.filter(t => t.name !== name);
            delete app.userTeams[name];
            app.players = app.players.filter(p => p.team !== name);
            app.budgets = app.budgets.filter(b => b.team !== name);
            
            saveData();
            showTab('teams');
        }

        function approvePlayer(id) {
            const player = app.pendingPlayers.find(p => p.id === id);
            if (!player) return;
            
            app.players.push(player);
            app.pendingPlayers = app.pendingPlayers.filter(p => p.id !== id);
            
            app.notifications.push({
                id: Date.now(),
                text: `Ø¨Ø§Ø²ÛŒÚ©Ù† ${player.name} Ø¨Ø±Ø§ÛŒ ØªÛŒÙ… ${player.team} ØªØ§ÛŒÛŒØ¯ Ø´Ø¯`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            showTab('teams');
        }

        function rejectPlayer(id) {
            app.pendingPlayers = app.pendingPlayers.filter(p => p.id !== id);
            saveData();
            showTab('teams');
        }

        function renderPlayersManager(c) {
            // Ù‡Ù…Ù‡ ØªÛŒÙ…â€ŒÙ‡Ø§ Ø´Ø§Ù…Ù„ Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒÚ©Ù†
            const allTeamsForPlayer = [...app.teams, { name: 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ' }].filter((t, i, arr) => arr.findIndex(x => x.name === t.name) === i);
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÛŒØ¹ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h2>
                    <div class="form-group">
                        <label>Ø§Ù†ØªØ®Ø§Ø¨ ØªÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù†Ù…ÙˆÙ†Ù‡</label>
                        <select id="bulkTeam">
                            <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                            ${allTeamsForPlayer.map(t => `<option value="${t.name}">${t.name}</option>`).join('')}
                        </select>
                    </div>
                    <button class="btn" onclick="createSamplePlayers()">ğŸš€ Ø³Ø§Ø®Øª Û±Û± Ø¨Ø§Ø²ÛŒÚ©Ù† Ù†Ù…ÙˆÙ†Ù‡</button>
                    <p style="color:#b0b0b0;margin-top:10px;font-size:0.9em;">ÛŒÚ© ØªØ±Ú©ÛŒØ¨ Ú©Ø§Ù…Ù„ Û±Û± Ù†ÙØ±Ù‡ Ø¨Ø±Ø§ÛŒ ØªÛŒÙ… Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†</h2>
                    <div class="form-row">
                        <div class="form-group"><label>Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†</label><input type="text" id="playerName"></div>
                        <div class="form-group"><label>ØªÛŒÙ…</label><select id="playerTeam">${allTeamsForPlayer.map(t => `<option>${t.name}</option>`).join('')}</select></div>
                        <div class="form-group"><label>Ù¾Ø³Øª</label><select id="playerPos"><option>GK</option><option>DF</option><option>MF</option><option>FW</option></select></div>
                        <div class="form-group"><label>Overall</label><input type="number" id="playerOverall" min="1" max="99" value="75"></div>
                    </div>
                    <button class="btn" onclick="addPlayer()">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†</button>
                </div>

                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ú†Ù†Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù† ÛŒÚ©Ø¬Ø§</h2>
                    <p style="color: #b0b0b0; margin-bottom: 15px;">ÙØ±Ù…Øª: Ù†Ø§Ù…ØŒØ§ÙˆØ±Ø§Ù„ØŒÙ¾Ø³Øª (Ù‡Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± ÛŒÚ© Ø®Ø·)</p>
                    <p style="color: #888; margin-bottom: 20px; font-size: 0.9em;">Ù…Ø«Ø§Ù„:<br>Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§ÛŒÛŒØŒ85ØŒGK<br>Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒØŒ78ØŒMF<br>Ø­Ø³ÛŒÙ† Ú©Ø±ÛŒÙ…ÛŒØŒ82ØŒDF</p>
                    <div class="form-group">
                        <label>ØªÛŒÙ…</label>
                        <select id="multiPlayerTeam">
                            ${allTeamsForPlayer.map(t => `<option>${t.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù„ÛŒØ³Øª Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</label>
                        <textarea id="multiPlayerList" rows="8" placeholder="Ù†Ø§Ù…ØŒØ§ÙˆØ±Ø§Ù„ØŒÙ¾Ø³Øª
Ù†Ø§Ù…ØŒØ§ÙˆØ±Ø§Ù„ØŒÙ¾Ø³Øª
..."></textarea>
                    </div>
                    <button class="btn" onclick="addMultiplePlayers()">Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ù…Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯</h2>
                    ${app.players.length === 0 ? '<p style="color:#b0b0b0;">Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : app.players.map(p => `
                        <div class="player-card">
                            <div class="player-info">
                                <div class="player-name">${p.name}</div>
                                <div class="player-details">${p.position} â€¢ ${p.team}</div>
                            </div>
                            <div class="player-overall">${p.overall}</div>
                            <div class="action-btns">
                                <button class="btn btn-secondary" onclick="editPlayer(${p.id})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                <button class="btn btn-danger" onclick="deletePlayer(${p.id})">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function createSamplePlayers() {
            const teamName = document.getElementById('bulkTeam').value;
            
            if (!teamName) {
                alert('Ù„Ø·ÙØ§ ÛŒÚ© ØªÛŒÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }

            const samplePlayers = [
                { name: 'Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ', position: 'GK', overall: 82 },
                { name: 'Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ÛŒ', position: 'DF', overall: 78 },
                { name: 'Ø­Ø³ÛŒÙ† Ù…Ø­Ù…Ø¯ÛŒ', position: 'DF', overall: 80 },
                { name: 'Ø±Ø¶Ø§ Ú©Ø±ÛŒÙ…ÛŒ', position: 'DF', overall: 77 },
                { name: 'Ø§Ù…ÛŒØ± Ø­Ø³ÛŒÙ†ÛŒ', position: 'DF', overall: 79 },
                { name: 'Ù…Ù‡Ø¯ÛŒ ØµØ§Ø¯Ù‚ÛŒ', position: 'MF', overall: 81 },
                { name: 'Ø³Ø¹ÛŒØ¯ Ø¹Ø²ÛŒØ²ÛŒ', position: 'MF', overall: 83 },
                { name: 'Ø¹Ù„ÛŒ Ø§Ú©Ø¨Ø±ÛŒ', position: 'MF', overall: 80 },
                { name: 'Ø­Ù…ÛŒØ¯ Ø±Ø­ÛŒÙ…ÛŒ', position: 'MF', overall: 78 },
                { name: 'Ú©Ø±ÛŒÙ… Ø¨Ø§Ù‚Ø±ÛŒ', position: 'FW', overall: 85 },
                { name: 'ÛŒØ§Ø³Ø± Ø§ØµØºØ±ÛŒ', position: 'FW', overall: 84 }
            ];

            let addedCount = 0;
            samplePlayers.forEach(player => {
                app.players.push({
                    id: Date.now() + addedCount,
                    name: player.name,
                    team: teamName,
                    position: player.position,
                    overall: player.overall
                });
                addedCount++;
            });

            saveData();
            alert(`âœ… ${addedCount} Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø±Ø§ÛŒ ØªÛŒÙ… ${teamName} Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!`);
            showTab('players');
        }

        function addPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const team = document.getElementById('playerTeam').value;
            const position = document.getElementById('playerPos').value;
            const overall = parseInt(document.getElementById('playerOverall').value);
            
            if (!name || !team) {
                alert('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ ØªÛŒÙ… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            app.players.push({ id: Date.now(), name, team, position, overall });
            saveData();
            showTab('players');
        }

        function addMultiplePlayers() {
            const team = document.getElementById('multiPlayerTeam').value;
            const list = document.getElementById('multiPlayerList').value.trim();
            
            if (!team) {
                alert('Ù„Ø·ÙØ§ ØªÛŒÙ… Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            if (!list) {
                alert('Ù„Ø·ÙØ§ Ù„ÛŒØ³Øª Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const lines = list.split('\n').filter(line => line.trim());
            let successCount = 0;
            let errorLines = [];
            
            lines.forEach((line, index) => {
                const parts = line.split('ØŒ').map(p => p.trim());
                
                if (parts.length !== 3) {
                    errorLines.push(`Ø®Ø· ${index + 1}: ÙØ±Ù…Øª Ù†Ø§Ø¯Ø±Ø³Øª - Ø¨Ø§ÛŒØ¯ Ø³Ù‡ Ø¨Ø®Ø´ Ø¨Ø§Ø´Ø¯ (Ù†Ø§Ù…ØŒØ§ÙˆØ±Ø§Ù„ØŒÙ¾Ø³Øª)`);
                    return;
                }
                
                const [name, overallStr, position] = parts;
                const overall = parseInt(overallStr);
                
                if (!name) {
                    errorLines.push(`Ø®Ø· ${index + 1}: Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª`);
                    return;
                }
                
                if (isNaN(overall) || overall < 1 || overall > 99) {
                    errorLines.push(`Ø®Ø· ${index + 1}: Ø§ÙˆØ±Ø§Ù„ Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ø¨ÛŒÙ† 1 ØªØ§ 99 Ø¨Ø§Ø´Ø¯`);
                    return;
                }
                
                const validPositions = ['GK', 'DF', 'MF', 'FW'];
                if (!validPositions.includes(position)) {
                    errorLines.push(`Ø®Ø· ${index + 1}: Ù¾Ø³Øª Ø¨Ø§ÛŒØ¯ ÛŒÚ©ÛŒ Ø§Ø² GKØŒ DFØŒ MFØŒ FW Ø¨Ø§Ø´Ø¯`);
                    return;
                }
                
                app.players.push({
                    id: Date.now() + index,
                    name,
                    team,
                    position,
                    overall
                });
                
                successCount++;
            });
            
            if (successCount > 0) {
                saveData();
            }
            
            if (errorLines.length > 0) {
                alert(`${successCount} Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.\n\nØ®Ø·Ø§Ù‡Ø§:\n${errorLines.join('\n')}`);
            } else {
                alert(`âœ… ${successCount} Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
            }
            
            if (successCount > 0) {
                showTab('players');
            }
        }

        function editPlayer(id) {
            const player = app.players.find(p => p.id === id);
            if (!player) return;
            
            const newName = prompt('Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯:', player.name);
            const newOverall = prompt('Overall Ø¬Ø¯ÛŒØ¯:', player.overall);
            
            if (newName) player.name = newName;
            if (newOverall) player.overall = parseInt(newOverall);
            
            saveData();
            showTab('players');
        }

        function deletePlayer(id) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            app.players = app.players.filter(p => p.id !== id);
            saveData();
            showTab('players');
        }

        function renderMatchesManager(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³Ø§Ø¨Ù‚Ù‡</h2>
                    <div class="form-row">
                        <div class="form-group"><label>ØªÛŒÙ… Ù…ÛŒØ²Ø¨Ø§Ù†</label><select id="homeTeam">${app.teams.map(t => `<option>${t.name}</option>`).join('')}</select></div>
                        <div class="form-group"><label>ØªÛŒÙ… Ù…Ù‡Ù…Ø§Ù†</label><select id="awayTeam">${app.teams.map(t => `<option>${t.name}</option>`).join('')}</select></div>
                        <div class="form-group"><label>Ú¯Ù„ Ù…ÛŒØ²Ø¨Ø§Ù†</label><input type="number" id="homeScore" min="0" value="0"></div>
                        <div class="form-group"><label>Ú¯Ù„ Ù…Ù‡Ù…Ø§Ù†</label><input type="number" id="awayScore" min="0" value="0"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Ú¯Ù„Ø²Ù†Ø§Ù† Ù…ÛŒØ²Ø¨Ø§Ù†</label><input type="text" id="homeScorers" placeholder="Ù†Ø§Ù… Ú¯Ù„Ø²Ù†Ø§Ù† Ø±Ø§ Ø¨Ø§ ÙˆÛŒØ±Ú¯ÙˆÙ„ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯"></div>
                        <div class="form-group"><label>Ú¯Ù„Ø²Ù†Ø§Ù† Ù…Ù‡Ù…Ø§Ù†</label><input type="text" id="awayScorers" placeholder="Ù†Ø§Ù… Ú¯Ù„Ø²Ù†Ø§Ù† Ø±Ø§ Ø¨Ø§ ÙˆÛŒØ±Ú¯ÙˆÙ„ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯"></div>
                        <div class="form-group"><label>Ø¶Ø±ÛŒØ¨ Ø´Ø±Ø· (Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† ØªØ¹Ø¯Ø§Ø¯ Ú¯Ù„ â€” ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†)</label><input type="number" id="goalOddsMultiplier" min="1" value="2"></div>
                    </div>
                    <button class="btn" onclick="addMatch()">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø³Ø§Ø¨Ù‚Ù‡</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø«Ø¨Øª Ø´Ø¯Ù‡</h2>
                    ${app.matches.length === 0 ? '<p style="color:#b0b0b0;">Ù…Ø³Ø§Ø¨Ù‚Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : app.matches.map((m, idx) => `
                        <div class="match-card">
                            <div class="match-teams">
                                <span class="team-name">${m.home}</span>
                                <span class="match-score">${m.homeScore} - ${m.awayScore}</span>
                                <span class="team-name">${m.away}</span>
                            </div>
                            ${m.scorers ? `<div style="color:#b0b0b0;margin-top:10px;">Ú¯Ù„Ø²Ù†Ø§Ù†: ${m.scorers}</div>` : ''}
                            <div class="action-btns">
                                <button class="btn btn-secondary" onclick="editMatch(${idx})">ÙˆÛŒØ±Ø§ÛŒØ´ Ú¯Ù„Ø²Ù†Ø§Ù†</button>
                                <button class="btn btn-danger" onclick="deleteMatch(${idx})">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function addMatch() {
            const home = document.getElementById('homeTeam').value;
            const away = document.getElementById('awayTeam').value;
            const homeScore = parseInt(document.getElementById('homeScore').value);
            const awayScore = parseInt(document.getElementById('awayScore').value);
            const homeScorers = document.getElementById('homeScorers').value.trim();
            const awayScorers = document.getElementById('awayScorers').value.trim();
            
            if (home === away) {
                alert('ØªÛŒÙ…â€ŒÙ‡Ø§ Ù†Ø¨Ø§ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯');
                return;
            }
            
            let scorers = '';
            if (homeScorers) scorers += `${home}: ${homeScorers}`;
            if (awayScorers) scorers += (scorers ? ' | ' : '') + `${away}: ${awayScorers}`;
            
            const goalOddsMultiplier = parseFloat(document.getElementById('goalOddsMultiplier') ? document.getElementById('goalOddsMultiplier').value : 2) || 2;
            app.matches.push({ home, away, homeScore, awayScore, scorers, goalOddsMultiplier });
            
            const homeTeam = app.teams.find(t => t.name === home);
            const awayTeam = app.teams.find(t => t.name === away);
            
            if (homeTeam && awayTeam) {
                homeTeam.gf += homeScore;
                homeTeam.ga += awayScore;
                awayTeam.gf += awayScore;
                awayTeam.ga += homeScore;
                
                if (homeScore > awayScore) {
                    homeTeam.w++;
                    homeTeam.p += 3;
                    awayTeam.l++;
                } else if (homeScore < awayScore) {
                    awayTeam.w++;
                    awayTeam.p += 3;
                    homeTeam.l++;
                } else {
                    homeTeam.d++;
                    awayTeam.d++;
                    homeTeam.p++;
                    awayTeam.p++;
                }
            }
            
            saveData();
            // Resolve bets related to this newly added match (last index)
            processBetsForMatch(app.matches.length - 1);
            showTab('matches');
        }

        function editMatch(idx) {
            const match = app.matches[idx];
            if (!match) return;
            
            const homeScorers = prompt(`Ú¯Ù„Ø²Ù†Ø§Ù† ${match.home}:`, '');
            const awayScorers = prompt(`Ú¯Ù„Ø²Ù†Ø§Ù† ${match.away}:`, '');
            
            let scorers = '';
            if (homeScorers) scorers += `${match.home}: ${homeScorers}`;
            if (awayScorers) scorers += (scorers ? ' | ' : '') + `${match.away}: ${awayScorers}`;
            
            match.scorers = scorers;
            
            saveData();
            // Resolve bets related to this newly added match (last index)
            processBetsForMatch(app.matches.length - 1);
            showTab('matches');
        }

        function deleteMatch(idx) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            app.matches.splice(idx, 1);
            saveData();
            // Resolve bets related to this newly added match (last index)
            processBetsForMatch(app.matches.length - 1);
            showTab('matches');
        }

        function renderBudgetManager(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø¨ÙˆØ¯Ø¬Ù‡ ØªÛŒÙ…â€ŒÙ‡Ø§</h2>
                    ${app.budgets.length === 0 ? '<p style="color:#b0b0b0;">Ø¨ÙˆØ¯Ø¬Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : `
                        <table class="data-table">
                            <thead><tr><th>ØªÛŒÙ…</th><th>Ø¨ÙˆØ¯Ø¬Ù‡ ÙØ¹Ù„ÛŒ (ÛŒÙˆØ±Ùˆ)</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead>
                            <tbody>${app.budgets.map((b, idx) => `
                                <tr>
                                    <td>${b.team}</td>
                                    <td>${b.budget.toLocaleString()}</td>
                                    <td><button class="btn btn-secondary" onclick="editBudget(${idx})">ÙˆÛŒØ±Ø§ÛŒØ´</button></td>
                                </tr>
                            `).join('')}</tbody>
                        </table>
                    `}
                </div>
            `;
        }

        function editBudget(idx) {
            const budget = app.budgets[idx];
            if (!budget) return;
            
            const newBudget = prompt(`Ø¨ÙˆØ¯Ø¬Ù‡ Ø¬Ø¯ÛŒØ¯ ${budget.team} (ÛŒÙˆØ±Ùˆ):`, budget.budget);
            if (newBudget) {
                budget.budget = parseInt(newBudget.replace(/,/g, ''));
                saveData();
                showTab('budget');
            }
        }

        function renderTransfersManager(c) {
            // Ù‡Ù…Ù‡ ØªÛŒÙ…â€ŒÙ‡Ø§ Ø´Ø§Ù…Ù„ Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ
            const allTeams = [...app.teams.map(t => t.name), 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ'];
            const uniqueTeams = [...new Set(allTeams)];
            
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ (Ø§Ø¯Ù…ÛŒÙ†)</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø¨Ø§Ø²ÛŒÚ©Ù†</label>
                            <select id="transferPlayer">
                                <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù† --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ø² ØªÛŒÙ…</label>
                            <select id="transferFrom">
                                <option value="">-- ØªÛŒÙ… Ù…Ø¨Ø¯Ø£ --</option>
                                ${uniqueTeams.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø¨Ù‡ ØªÛŒÙ…</label>
                            <select id="transferTo">
                                <option value="">-- ØªÛŒÙ… Ù…Ù‚ØµØ¯ --</option>
                                ${uniqueTeams.map(t => `<option value="${t}">${t}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Ù…Ø¨Ù„Øº (ÛŒÙˆØ±Ùˆ)</label><input type="number" id="transferAmount" min="0"></div>
                        <div class="form-group"><label>Ù…Ø¯Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Ø³Ø§Ù„)</label><input type="number" id="transferDuration" min="1" max="10" value="3"></div>
                        <div class="form-group"><label>ØªØµÙˆÛŒØ± (URL)</label><input type="url" id="transferImg"></div>
                    </div>
                    <button class="btn" onclick="addTransfer()">Ø§ÙØ²ÙˆØ¯Ù† Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù†</button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ø«Ø¨Øª Ø´Ø¯Ù‡</h2>
                    ${app.transfers.length === 0 ? '<p style="color:#b0b0b0;">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : app.transfers.map((tr, idx) => `
                        <div class="transfer-card">
                            ${tr.img ? `<img src="${tr.img}" class="transfer-image" alt="${tr.player}">` : ''}
                            <div class="transfer-details">
                                <div class="transfer-player">${tr.player}</div>
                                <div class="transfer-route">${tr.from} â†’ ${tr.to}</div>
                                <div class="transfer-price">${(tr.amount||0).toLocaleString()} ÛŒÙˆØ±Ùˆ â€¢ ${tr.duration} Ø³Ø§Ù„</div>
                            </div>
                            <div class="action-btns">
                                <button class="btn btn-secondary" onclick="editTransfer(${idx})">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                <button class="btn btn-danger" onclick="deleteTransfer(${idx})">Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // ÙˆÙ‚ØªÛŒ ØªÛŒÙ… Ù…Ø¨Ø¯Ø£ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒØ´Ù‡ ÙÙ‚Ø· Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù‡Ù…Ø§Ù† ØªÛŒÙ… Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯
            function populateTransferPlayersByFrom() {
                const from = document.getElementById('transferFrom').value;
                const playerSelect = document.getElementById('transferPlayer');
                // reset
                playerSelect.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù† --</option>';
                if (!from) return;
                // add players that belong to the selected 'from' team
                app.players.filter(p => p.team === from).forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p.name;
                    opt.setAttribute('data-id', p.id);
                    opt.setAttribute('data-team', p.team);
                    opt.textContent = `${p.name} (${p.team})`;
                    playerSelect.appendChild(opt);
                });
            }
            document.getElementById('transferFrom').addEventListener('change', populateTransferPlayersByFrom);
            // populate initially based on current value (if any)
            populateTransferPlayersByFrom();
        }

        function addTransfer() {
            const playerSelect = document.getElementById('transferPlayer');
            const playerName = playerSelect.value;
            const playerId = playerSelect.options[playerSelect.selectedIndex].getAttribute('data-id');
            const from = document.getElementById('transferFrom').value;
            const to = document.getElementById('transferTo').value;
            const amount = parseInt(document.getElementById('transferAmount').value) || 0;
            const duration = parseInt(document.getElementById('transferDuration').value) || 1;
            const img = document.getElementById('transferImg').value.trim();
            
            if (!playerName || !from || !to) {
                alert('Ù„Ø·ÙØ§ Ø¨Ø§Ø²ÛŒÚ©Ù†ØŒ ØªÛŒÙ… Ù…Ø¨Ø¯Ø£ Ùˆ ØªÛŒÙ… Ù…Ù‚ØµØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            if (from === to) {
                alert('ØªÛŒÙ… Ù…Ø¨Ø¯Ø£ Ùˆ Ù…Ù‚ØµØ¯ Ù†Ø¨Ø§ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯');
                return;
            }
            
            // Ú©Ù… Ú©Ø±Ø¯Ù† Ø¨ÙˆØ¯Ø¬Ù‡ Ø§Ø² ØªÛŒÙ… Ù…Ù‚ØµØ¯
            if (to !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ' && amount > 0) {
                const destBudget = app.budgets.find(b => b.team === to);
                if (destBudget) {
                    if (destBudget.budget < amount) {
                        if (!confirm(`Ø¨ÙˆØ¯Ø¬Ù‡ ØªÛŒÙ… ${to} Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª (${destBudget.budget.toLocaleString()} ÛŒÙˆØ±Ùˆ). Ø¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ`)) return;
                    }
                    destBudget.budget -= amount;
                }
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨ÙˆØ¯Ø¬Ù‡ ØªÛŒÙ… Ù…Ø¨Ø¯Ø£ (Ø§Ú¯Ø± Ø¢Ø²Ø§Ø¯ Ù†ÛŒØ³Øª)
                if (from !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ') {
                    const srcBudget = app.budgets.find(b => b.team === from);
                    if (srcBudget) srcBudget.budget += amount;
                }
            }
            
            // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ù‡ ØªÛŒÙ… Ù…Ù‚ØµØ¯
            if (playerId) {
                const player = app.players.find(p => p.id === parseInt(playerId));
                if (player) {
                    player.team = to;
                    console.log(`âœ“ Ø¨Ø§Ø²ÛŒÚ©Ù† ${playerName} Ø§Ø² ${from} Ø¨Ù‡ ${to} Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯`);
                } else {
                    console.error(`! Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø§ ID ${playerId} ÛŒØ§ÙØª Ù†Ø´Ø¯`);
                    alert(`âš ï¸ Ø®Ø·Ø§: Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø§ ID ${playerId} Ø¯Ø± Ø³ÛŒØ³ØªÙ… ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø§Ù…Ø§ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…Ù†ØªÙ‚Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.`);
                }
            } else {
                // Ø§Ú¯Ø± playerId Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ø¨Ø§ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¬Ø³ØªØ¬Ùˆ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                const player = app.players.find(p => p.name === playerName && p.team === from);
                if (player) {
                    player.team = to;
                    console.log(`âœ“ Ø¨Ø§Ø²ÛŒÚ©Ù† ${playerName} Ø§Ø² ${from} Ø¨Ù‡ ${to} Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯ (Ø¨Ø§ Ù†Ø§Ù…)`);
                } else {
                    console.error(`! Ø¨Ø§Ø²ÛŒÚ©Ù† ${playerName} Ø¯Ø± ØªÛŒÙ… ${from} ÛŒØ§ÙØª Ù†Ø´Ø¯`);
                    alert(`âš ï¸ Ø®Ø·Ø§: Ø¨Ø§Ø²ÛŒÚ©Ù† ${playerName} Ø¯Ø± ØªÛŒÙ… ${from} ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø¨Ø§Ø²ÛŒÚ©Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.`);
                    return;
                }
            }
            
            app.transfers.push({ player: playerName, playerId: parseInt(playerId), from, to, amount, duration, img });
            
            app.notifications.push({
                id: Date.now(),
                text: `âœ… Ø§Ù†ØªÙ‚Ø§Ù„ Ø±Ø³Ù…ÛŒ: ${playerName} Ø§Ø² ${from} Ø¨Ù‡ ${to} Ø¨Ù‡ Ù…Ø¨Ù„Øº ${amount.toLocaleString()} ÛŒÙˆØ±Ùˆ`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            showTab('transfers');
        }

        function deleteTransfer(idx) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            app.transfers.splice(idx, 1);
            saveData();
            showTab('transfers');
        }

        function editTransfer(idx) {
            const tr = app.transfers[idx];
            if (!tr) return;
            
            const newAmount = prompt('Ù…Ø¨Ù„Øº Ø¬Ø¯ÛŒØ¯ (ÛŒÙˆØ±Ùˆ):', tr.amount || 0);
            const newDuration = prompt('Ù…Ø¯Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯ (Ø³Ø§Ù„):', tr.duration || 3);
            const newImg = prompt('Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ± Ø¬Ø¯ÛŒØ¯ (URL):', tr.img || '');
            
            if (newAmount !== null && newAmount.trim() !== '') {
                tr.amount = parseInt(newAmount) || 0;
            }
            if (newDuration !== null && newDuration.trim() !== '') {
                tr.duration = parseInt(newDuration) || 1;
            }
            if (newImg !== null) {
                tr.img = newImg.trim();
            }
            
            saveData();
            showTab('transfers');
        }

        // ------- Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ (Ø§Ø¶Ø§ÙÙ‡â€ŒØ´Ø¯Ù‡ Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª) -------
        function computeTeamStrength(teamName) {
            const players = app.players.filter(p => p.team === teamName);
            if (!players || players.length === 0) {
                const t = app.teams.find(x => x.name === teamName);
                return (t && t.overall) ? t.overall : 75;
            }
            const avg = players.reduce((s,p) => s + (p.overall||75), 0) / players.length;
            return avg;
        }

        function computeOdds(home, away, matchObj) {
            const hStr = computeTeamStrength(home) || 75;
            const aStr = computeTeamStrength(away) || 75;
            const homeOdd = Math.max(1.2, parseFloat(((aStr / hStr) * 1.5).toFixed(2)));
            const awayOdd = Math.max(1.2, parseFloat(((hStr / aStr) * 1.5).toFixed(2)));
            const drawOdd = 2.5;
            return { home: homeOdd, away: awayOdd, draw: drawOdd };
        }

        function renderBettingView(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø´Ø±Ø·â€ŒØ¨Ù†Ø¯ÛŒ Ø±ÙˆÛŒ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h2>
                    <p style="color:#b0b0b0;">Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø±ÙˆÛŒ Ø¨Ø±Ù†Ø¯Ù‡ Ù…Ø³Ø§Ø¨Ù‚Ù‡ ÛŒØ§ ØªØ¹Ø¯Ø§Ø¯ Ú¯Ù„ (Ø§Ú¯Ø± Ø§Ø¯Ù…ÛŒÙ† Ø¶Ø±ÛŒØ¨ ØªØ¹ÛŒÛŒÙ† Ú©Ø±Ø¯Ù‡) Ø´Ø±Ø· Ø¨Ø¨Ù†Ø¯ÛŒØ¯. Ù…Ø¨Ù„Øº Ø´Ø±Ø· Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øª Ø§Ø² Ø¨ÙˆØ¯Ø¬Ù‡ Ú©Ø³Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                    <div id="betsArea"></div>
                </div>
            `;
            const betsArea = document.getElementById('betsArea');
            const matches = app.matches || [];
            if (matches.length === 0) {
                betsArea.innerHTML = '<p style="color:#b0b0b0;">Ù…Ø³Ø§Ø¨Ù‚Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>';
                return;
            }
            betsArea.innerHTML = matches.map((m, idx) => {
                const odds = computeOdds(m.home, m.away, m);
                const gmult = m.goalOddsMultiplier ? `â€¢ Ø¶Ø±ÛŒØ¨ Ú¯Ù„: ${m.goalOddsMultiplier}` : '';
                return `
                    <div style="padding:12px;margin-bottom:10px;background:rgba(255,255,255,0.03);border-radius:10px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div style="font-weight:700;">Ù…Ø³Ø§Ø¨Ù‚Ù‡ ${idx+1}: ${m.home} VS ${m.away}</div>
                            <div style="font-weight:700;color:#1eff00;">${m.homeScore ?? 0} - ${m.awayScore ?? 0}</div>
                        </div>
                        <div style="margin-top:8px;color:#b0b0b0;">
                            Ø¶Ø±Ø§ÛŒØ¨: Ø¨Ø±Ø¯ Ù…ÛŒØ²Ø¨Ø§Ù†: ${odds.home} â€” Ù…Ø³Ø§ÙˆÛŒ: ${odds.draw} â€” Ø¨Ø±Ø¯ Ù…Ù‡Ù…Ø§Ù†: ${odds.away} ${gmult}
                        </div>
                        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
                            <input type="number" id="betAmount_${idx}" placeholder="Ù…Ø¨Ù„Øº Ø´Ø±Ø· (ÛŒÙˆØ±Ùˆ)" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);width:160px;">
                            <select id="betType_${idx}" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);">
                                <option value="home">Ø¨Ø±Ø¯ ${m.home}</option>
                                <option value="draw">Ù…Ø³Ø§ÙˆÛŒ</option>
                                <option value="away">Ø¨Ø±Ø¯ ${m.away}</option>
                            </select>
                            ${m.goalOddsMultiplier ? `<input type="number" id="betExactGoals_${idx}" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ú¯Ù„ Ø¯Ù‚ÛŒÙ‚ (Ù…Ø¬Ù…ÙˆØ¹)" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);width:200px;">` : ''}
                            <button class="btn" onclick="placeBet(${idx})">Ø«Ø¨Øª Ø´Ø±Ø·</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function placeBet(matchIdx) {
            const amountEl = document.getElementById('betAmount_' + matchIdx);
            const typeEl = document.getElementById('betType_' + matchIdx);
            const exactGoalsEl = document.getElementById('betExactGoals_' + matchIdx);
            const stake = parseInt(amountEl ? amountEl.value : 0) || 0;
            const betType = typeEl ? typeEl.value : 'home';
            const match = app.matches[matchIdx];
            if (!match) { alert('Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª'); return; }
            if (stake <= 0) { alert('Ù…Ø¨Ù„Øº Ø´Ø±Ø· Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 0 Ø¨Ø§Ø´Ø¯'); return; }
            const bettor = app.team;
            const budgetObj = app.budgets.find(b => b.team === bettor);
            if (!budgetObj || budgetObj.budget < stake) { alert('Ø¨ÙˆØ¯Ø¬Ù‡ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª'); return; }
            const odds = computeOdds(match.home, match.away, match);
            let chosenOdd = odds[betType];
            if (exactGoalsEl && exactGoalsEl.value.trim() !== '') {
                const g = parseInt(exactGoalsEl.value);
                if (isNaN(g)) { alert('ØªØ¹Ø¯Ø§Ø¯ Ú¯Ù„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª'); return; }
                const mult = match.goalOddsMultiplier || 2;
                chosenOdd = chosenOdd * mult;
            }
            budgetObj.budget -= stake;
            const bet = {
                id: Date.now(),
                bettor,
                matchIdx,
                betType,
                stake,
                odds: parseFloat(chosenOdd.toFixed(2)),
                exactGoals: exactGoalsEl && exactGoalsEl.value.trim() !== '' ? parseInt(exactGoalsEl.value) : null,
                placedAt: new Date().toLocaleString('fa-IR'),
                resolved: false,
                won: false,
                payout: 0
            };
            app.bets = app.bets || [];
            app.bets.push(bet);
            app.notifications.push({ id: Date.now(), text: `Ø´Ø±Ø· Ø«Ø¨Øª Ø´Ø¯: ØªÛŒÙ… ${bettor} Ø±ÙˆÛŒ Ù…Ø³Ø§Ø¨Ù‚Ù‡ ${match.home} vs ${match.away} Ù…Ø¨Ù„Øº ${stake} ÛŒÙˆØ±Ùˆ`, time: new Date().toLocaleString('fa-IR') });
            saveData();
            alert('âœ… Ø´Ø±Ø· Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯. Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù†ØŒ Ù…Ø¨Ù„Øº Ø¨Ù‡ Ø¨ÙˆØ¯Ø¬Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
            renderBettingView(document.getElementById('content'));
        }

        function processBetsForMatch(matchIdx) {
            app.bets = app.bets || [];
            const match = app.matches[matchIdx];
            if (!match) return;
            app.bets.forEach(bet => {
                if (bet.matchIdx !== matchIdx || bet.resolved) return;
                let won = false;
                if (bet.betType === 'home' && match.homeScore > match.awayScore) won = true;
                if (bet.betType === 'away' && match.awayScore > match.homeScore) won = true;
                if (bet.betType === 'draw' && match.homeScore === match.awayScore) won = true;
                if (bet.exactGoals !== null && match.goalOddsMultiplier) {
                    const totalGoals = (match.homeScore || 0) + (match.awayScore || 0);
                    if (totalGoals === bet.exactGoals) {
                        won = true;
                    } else {
                        won = false;
                    }
                }
                bet.resolved = true;
                bet.won = won;
                if (won) {
                    const payout = Math.round(bet.stake * bet.odds);
                    bet.payout = payout;
                    const bud = app.budgets.find(b => b.team === bet.bettor);
                    if (bud) bud.budget += payout;
                    app.notifications.push({ id: Date.now(), text: `ğŸ† Ø´Ø±Ø· Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯: ØªÛŒÙ… ${bet.bettor} Ù…Ø¨Ù„Øº ${payout.toLocaleString()} ÛŒÙˆØ±Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯.`, time: new Date().toLocaleString('fa-IR') });
                } else {
                    app.notifications.push({ id: Date.now(), text: `âŒ Ø´Ø±Ø· Ø¨Ø§Ø®ØªÙ‡: ØªÛŒÙ… ${bet.bettor} Ø±ÙˆÛŒ Ù…Ø³Ø§Ø¨Ù‚Ù‡ ${match.home} vs ${match.away}`, time: new Date().toLocaleString('fa-IR') });
                }
            });
            saveData();
        }

        function renderNotifications(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ</h2>
                    ${app.notifications.length === 0 ? '<p style="color:#b0b0b0;">Ø§Ø¹Ù„Ø§Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : app.notifications.map((n, idx) => {
                        // Check if this is a player addition request
                        const isPlayerRequest = n.text.includes('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†');
                        const pendingPlayer = isPlayerRequest ? app.pendingPlayers.find(p => n.text.includes(p.name)) : null;
                        
                        // Check if this is a transfer request
                        const isTransferRequest = n.text.includes('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„');
                        const pendingTransfer = isTransferRequest ? (app.pendingTransfers || []).find(t => t.status === 'pending' && n.text.includes(t.playerName)) : null;
                        
                        return `
                            <div class="notification-item">
                                <div>${n.text}</div>
                                <div class="notification-time">${n.time}</div>
                                ${pendingPlayer ? `
                                    <div class="action-btns">
                                        <button class="btn" onclick="approvePlayerFromNotif(${pendingPlayer.id}, ${idx})">âœ… ØªØ§ÛŒÛŒØ¯</button>
                                        <button class="btn btn-danger" onclick="rejectPlayerFromNotif(${pendingPlayer.id}, ${idx})">âŒ Ø±Ø¯</button>
                                    </div>
                                ` : pendingTransfer ? `
                                    <div class="action-btns">
                                        <button class="btn" onclick="approvePendingTransfer(${pendingTransfer.id})">âœ… ØªØ£ÛŒÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„</button>
                                        <button class="btn btn-danger" onclick="rejectPendingTransfer(${pendingTransfer.id})">âŒ Ø±Ø¯ Ø§Ù†ØªÙ‚Ø§Ù„</button>
                                    </div>
                                ` : `
                                    <button class="btn btn-danger" style="margin-top:10px;" onclick="deleteNotification(${idx})">Ø­Ø°Ù</button>
                                `}
                            </div>
                        `;
                    }).join('')}
                    ${app.notifications.length > 0 ? '<button class="btn btn-danger" onclick="clearAllNotifications()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>' : ''}
                </div>
            `;
        }

        function approvePlayerFromNotif(playerId, notifIdx) {
            const player = app.pendingPlayers.find(p => p.id === playerId);
            if (!player) return;
            
            app.players.push(player);
            app.pendingPlayers = app.pendingPlayers.filter(p => p.id !== playerId);
            
            // Update notification text
            app.notifications[notifIdx].text = `âœ… Ø¨Ø§Ø²ÛŒÚ©Ù† ${player.name} Ø¨Ø±Ø§ÛŒ ØªÛŒÙ… ${player.team} ØªØ§ÛŒÛŒØ¯ Ø´Ø¯`;
            
            saveData();
            showTab('notifications');
            alert('Ø¨Ø§Ø²ÛŒÚ©Ù† ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!');
        }

        function rejectPlayerFromNotif(playerId, notifIdx) {
            const player = app.pendingPlayers.find(p => p.id === playerId);
            if (!player) return;
            
            app.pendingPlayers = app.pendingPlayers.filter(p => p.id !== playerId);
            
            // Update notification text
            app.notifications[notifIdx].text = `âŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§Ø²ÛŒÚ©Ù† ${player.name} Ø¨Ø±Ø§ÛŒ ØªÛŒÙ… ${player.team} Ø±Ø¯ Ø´Ø¯`;
            
            saveData();
            showTab('notifications');
            alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø¯ Ø´Ø¯!');
        }

        function deleteNotification(idx) {
            app.notifications.splice(idx, 1);
            saveData();
            showTab('notifications');
        }

        function clearAllNotifications() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            app.notifications = [];
            saveData();
            showTab('notifications');
        }

        function renderScheduleManager(c) {
            const leagueType = app.leagueType || 'league';
            const leagueTeams = app.teams.filter(t => t.name !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ');
            
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">ğŸ“… Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÙ‡â€ŒÙ‡Ø§</h2>
                    
                    <div class="settings-section">
                        <div class="settings-title">Ù†ÙˆØ¹ Ø±Ù‚Ø§Ø¨Øª</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ø¬Ø¯ÙˆÙ„ / Ø±Ù‚Ø§Ø¨Øª</label>
                                <select id="leagueTypeSelect" onchange="updateLeagueType()">
                                    <option value="league" ${leagueType === 'league' ? 'selected' : ''}>Ù„ÛŒÚ¯ Ùˆ Ø¬Ø§Ù… Ø­Ø°ÙÛŒ Ùˆ Ø³ÙˆÙ¾Ø±Ú©Ø§Ù¾</option>
                                    <option value="cup" ${leagueType === 'cup' ? 'selected' : ''}>Ø¬Ø§Ù… Ø­Ø°ÙÛŒ Ùˆ Ú¯Ø±ÙˆÙ‡ÛŒ</option>
                                </select>
                            </div>
                        </div>
                        <p style="color:#b0b0b0;font-size:0.9em;">Ù†ÙˆØ¹ Ø±Ù‚Ø§Ø¨Øª Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡: <strong style="color:#1eff00;">${leagueType === 'league' ? 'Ù„ÛŒÚ¯ Ùˆ Ø¬Ø§Ù… Ø­Ø°ÙÛŒ Ùˆ Ø³ÙˆÙ¾Ø±Ú©Ø§Ù¾' : 'Ø¬Ø§Ù… Ø­Ø°ÙÛŒ Ùˆ Ú¯Ø±ÙˆÙ‡ÛŒ'}</strong></p>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">ğŸ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ø§Ù… Ø­Ø°ÙÛŒ Ùˆ Ú¯Ø±ÙˆÙ‡ÛŒ</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ØªØ¹Ø¯Ø§Ø¯ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</label>
                                <input type="number" id="groupsCount" min="1" max="16" value="2">
                            </div>
                            <div class="form-group">
                                <label>ØªØ¹Ø¯Ø§Ø¯ ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ ØµØ¹ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡ Ø§Ø² Ù‡Ø± Ú¯Ø±ÙˆÙ‡</label>
                                <input type="number" id="advancePerGroup" min="1" max="8" value="2">
                            </div>
                        </div>
                        <p style="color:#b0b0b0;font-size:0.9em;">Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯. Ø¨Ø¹Ø¯ Ø§Ø² Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ø²Ø¯Ù† Ø¯Ú©Ù…Ù‡ "ØµØ¹ÙˆØ¯ Û² ØªÛŒÙ… Ø§ÙˆÙ„" ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ ØµØ¹ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.</p>
                        <div style="display:flex;gap:10px;margin-top:10px;"><button class="btn" onclick="runGroupDraw()">Ù‚Ø±Ø¹Ù‡â€ŒÚ©Ø´ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ</button><button class="btn" onclick="advanceFromGroups()">ØµØ¹ÙˆØ¯ Û² ØªÛŒÙ… Ø§ÙˆÙ„</button></div>
                        <div id="groupsArea" style="margin-top:15px;color:#b0b0b0;"></div>
                    </div>
    
                    
                    <div class="settings-section">
                        <div class="settings-title">Ø³Ø§Ø®Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡ÙØªÙ‡â€ŒÙ‡Ø§</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡</label>
                                <select id="scheduleType">
                                    <option value="home_away">Ø±ÙØª Ùˆ Ø¨Ø±Ú¯Ø´Øª (Ø¯Ùˆ Ø¯ÙˆØ±)</option>
                                    <option value="home_only">ÙÙ‚Ø· Ø±ÙØª (ÛŒÚ© Ø¯ÙˆØ±)</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="generateSchedule()">ğŸ”„ Ø³Ø§Ø®Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡</button>
                        ${app.schedule && app.schedule.length > 0 ? `<button class="btn btn-danger" style="margin-right:10px;" onclick="clearSchedule()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡</button>` : ''}
                    </div>
                    
                    ${app.schedule && app.schedule.length > 0 ? `
                        <div class="settings-section">
                            <div class="settings-title">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª (${app.schedule.length} Ù‡ÙØªÙ‡)</div>
                            ${app.schedule.map((week, wi) => `
                                <div style="margin-bottom:20px;">
                                    <div style="color:#1eff00;font-weight:700;margin-bottom:10px;font-size:1.1em;">Ù‡ÙØªÙ‡ ${wi + 1}</div>
                                    ${week.matches.map((m, mi) => {
                                        const played = app.matches.find(x => x.home === m.home && x.away === m.away);
                                        return `
                                        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:rgba(255,255,255,0.05);border-radius:10px;margin-bottom:8px;gap:10px;">
                                            <span style="font-weight:600;min-width:80px;text-align:right;">${m.home}</span>
                                            ${played ? `
                                                <span style="color:#1eff00;padding:5px 15px;background:rgba(30,255,0,0.1);border-radius:8px;font-weight:700;">${played.homeScore} - ${played.awayScore}</span>
                                            ` : `
                                                <button class="btn btn-secondary" style="padding:6px 14px;font-size:0.85em;" onclick="openScheduleResult(${wi}, ${mi})">Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡</button>
                                            `}
                                            <span style="font-weight:600;min-width:80px;text-align:left;">${m.away}</span>
                                        </div>
                                        `;
                                    }).join('')}
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p style="color:#b0b0b0;margin-top:15px;">Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ø³Ø§Ø®ØªÙ‡ Ù†Ø´Ø¯Ù‡. Ø±ÙˆÛŒ "Ø³Ø§Ø®Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</p>'}

                    <div class="modal" id="scheduleResultModal">
                        <div class="modal-content">
                            <div class="modal-header">Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ Ù…Ø³Ø§Ø¨Ù‚Ù‡</div>
                            <div id="scheduleResultBody"></div>
                            <button class="modal-close" onclick="closeScheduleResultModal()">Ø¨Ø³ØªÙ†</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateLeagueType() {
            app.leagueType = document.getElementById('leagueTypeSelect').value;
            saveData();
            renderScheduleManager(document.getElementById('content'));
        }

        function generateSchedule() {
            const leagueTeams = app.teams.filter(t => t.name !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ');
            if (leagueTeams.length < 2) {
                alert('Ø­Ø¯Ø§Ù‚Ù„ Û² ØªÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª');
                return;
            }
            
            const scheduleType = document.getElementById('scheduleType').value;
            const teams = leagueTeams.map(t => t.name);
            const schedule = [];
            
            // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Round Robin
            const n = teams.length % 2 === 0 ? teams.length : teams.length + 1;
            const rounds = n - 1;
            const teamsArr = [...teams];
            if (teams.length % 2 !== 0) teamsArr.push('BYE');
            
            for (let r = 0; r < rounds; r++) {
                const weekMatches = [];
                for (let i = 0; i < n / 2; i++) {
                    const home = teamsArr[i];
                    const away = teamsArr[n - 1 - i];
                    if (home !== 'BYE' && away !== 'BYE') {
                        weekMatches.push({ home, away });
                    }
                }
                schedule.push({ matches: weekMatches });
                
                // Ú†Ø±Ø®Ø§Ù†Ø¯Ù† ØªÛŒÙ…â€ŒÙ‡Ø§ (Ø«Ø§Ø¨Øª Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† Ø§ÙˆÙ„)
                const last = teamsArr.pop();
                teamsArr.splice(1, 0, last);
            }
            
            // Ø§Ú¯Ù‡ Ø±ÙØª Ùˆ Ø¨Ø±Ú¯Ø´Øª Ø¨Ø§Ø´Ù‡ØŒ Ø¯ÙˆØ± Ø¨Ø±Ú¯Ø´Øª Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
            if (scheduleType === 'home_away') {
                const returnSchedule = schedule.map(week => ({
                    matches: week.matches.map(m => ({ home: m.away, away: m.home }))
                }));
                app.schedule = [...schedule, ...returnSchedule];
            } else {
                app.schedule = schedule;
            }
            
            saveData();
            renderScheduleManager(document.getElementById('content'));
            alert(`âœ… Ø¨Ø±Ù†Ø§Ù…Ù‡ ${app.schedule.length} Ù‡ÙØªÙ‡â€ŒØ§ÛŒ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!`);
        }

        function clearSchedule() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            app.schedule = [];
            saveData();
            renderScheduleManager(document.getElementById('content'));
        }

        function openScheduleResult(wi, mi) {
            const m = app.schedule[wi].matches[mi];
            document.getElementById('scheduleResultBody').innerHTML = `
                <p style="margin-bottom:15px;color:#b0b0b0;">${m.home} Ø¯Ø± Ù…Ù‚Ø§Ø¨Ù„ ${m.away}</p>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ú¯Ù„ ${m.home}</label>
                        <input type="number" id="sr_homeScore" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Ú¯Ù„ ${m.away}</label>
                        <input type="number" id="sr_awayScore" min="0" value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Ú¯Ù„Ø²Ù†Ø§Ù† ${m.home}</label>
                    <input type="text" id="sr_homeScorers" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒØŒ Ø±Ø¶Ø§">
                </div>
                <div class="form-group">
                    <label>Ú¯Ù„Ø²Ù†Ø§Ù† ${m.away}</label>
                    <input type="text" id="sr_awayScorers" placeholder="Ù…Ø«Ø§Ù„: Ø­Ø³Ù†ØŒ Ù…Ù‡Ø¯ÛŒ">
                </div>
                <button class="btn" onclick="submitScheduleResult('${m.home}', '${m.away}')">âœ… Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡</button>
            `;
            document.getElementById('scheduleResultModal').classList.add('show');
        }

        function closeScheduleResultModal() {
            document.getElementById('scheduleResultModal').classList.remove('show');
        }

        function submitScheduleResult(home, away) {
            const homeScore = parseInt(document.getElementById('sr_homeScore').value) || 0;
            const awayScore = parseInt(document.getElementById('sr_awayScore').value) || 0;
            const homeScorers = document.getElementById('sr_homeScorers').value.trim();
            const awayScorers = document.getElementById('sr_awayScorers').value.trim();

            let scorers = '';
            if (homeScorers) scorers += `${home}: ${homeScorers}`;
            if (awayScorers) scorers += (scorers ? ' | ' : '') + `${away}: ${awayScorers}`;

            app.matches.push({ home, away, homeScore, awayScore, scorers, goalOddsMultiplier: 2 });

            const homeTeam = app.teams.find(t => t.name === home);
            const awayTeam = app.teams.find(t => t.name === away);
            if (homeTeam && awayTeam) {
                homeTeam.gf += homeScore; homeTeam.ga += awayScore;
                awayTeam.gf += awayScore; awayTeam.ga += homeScore;
                if (homeScore > awayScore) { homeTeam.w++; homeTeam.p += 3; awayTeam.l++; }
                else if (homeScore < awayScore) { awayTeam.w++; awayTeam.p += 3; homeTeam.l++; }
                else { homeTeam.d++; awayTeam.d++; homeTeam.p++; awayTeam.p++; }
            }

            processBetsForMatch(app.matches.length - 1);
            saveData();
            closeScheduleResultModal();
            renderScheduleManager(document.getElementById('content'));
        }

        function renderPendingTransfersManager(c) {
            const pending = (app.pendingTransfers || []).filter(t => t.status === 'pending');
            const history = (app.pendingTransfers || []).filter(t => t.status !== 'pending');
            
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">ğŸ”„ Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ ${pending.length > 0 ? `<span class="pending-badge">${pending.length}</span>` : ''}</h2>
                    ${pending.length === 0 ? '<p style="color:#b0b0b0;">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù†ÛŒØ³Øª</p>' : pending.map((tr, idx) => `
                        <div class="transfer-card" style="border-color:rgba(255,165,0,0.4);">
                            <div class="transfer-details" style="flex:1;">
                                <div class="transfer-player">ğŸ”„ ${tr.playerName}</div>
                                <div class="transfer-route">${tr.from} â†’ ${tr.to}</div>
                                <div class="transfer-price">${(tr.amount||0).toLocaleString()} ÛŒÙˆØ±Ùˆ â€¢ ${tr.duration || 1} Ø³Ø§Ù„</div>
                                <div style="color:#888;font-size:0.85em;margin-top:5px;">Ø§Ø±Ø³Ø§Ù„ ØªÙˆØ³Ø·: ØªÛŒÙ… ${tr.requestedBy} â€¢ ${tr.time}</div>
                            </div>
                            <div style="display:flex;flex-direction:column;gap:10px;">
                                <button class="btn" onclick="approvePendingTransfer(${tr.id})">âœ… ØªØ£ÛŒÛŒØ¯</button>
                                <button class="btn btn-danger" onclick="rejectPendingTransfer(${tr.id})">âŒ Ø±Ø¯</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${history.length > 0 ? `
                <div class="card">
                    <h2 class="card-title">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</h2>
                    ${history.map(tr => `
                        <div class="transfer-card" style="border-color:${tr.status === 'approved' ? 'rgba(30,255,0,0.3)' : 'rgba(255,50,50,0.3)'};">
                            <div class="transfer-details">
                                <div class="transfer-player">${tr.status === 'approved' ? 'âœ…' : 'âŒ'} ${tr.playerName}</div>
                                <div class="transfer-route">${tr.from} â†’ ${tr.to}</div>
                                <div style="color:#888;font-size:0.85em;">${tr.status === 'approved' ? 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯' : 'Ø±Ø¯ Ø´Ø¯'} â€¢ ${tr.time}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;
        }

        function approvePendingTransfer(id) {
            if (!app.pendingTransfers) return;
            const tr = app.pendingTransfers.find(t => t.id === id);
            if (!tr) return;
            
            tr.status = 'approved';
            
            // Ú©Ù… Ú©Ø±Ø¯Ù† Ø¨ÙˆØ¯Ø¬Ù‡ Ø§Ø² ØªÛŒÙ… Ù…Ù‚ØµØ¯
            if (tr.to !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ' && tr.amount > 0) {
                const destBudget = app.budgets.find(b => b.team === tr.to);
                if (destBudget) destBudget.budget -= tr.amount;
                if (tr.from !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ') {
                    const srcBudget = app.budgets.find(b => b.team === tr.from);
                    if (srcBudget) srcBudget.budget += tr.amount;
                }
            }
            
            // Ø§Ù†ØªÙ‚Ø§Ù„ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†
            const player = app.players.find(p => p.id === tr.playerId);
            if (player) player.team = tr.to;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø±Ø³Ù…ÛŒ
            app.transfers.push({ player: tr.playerName, playerId: tr.playerId, from: tr.from, to: tr.to, amount: tr.amount, duration: tr.duration || 1, img: tr.img || '' });
            
            app.notifications.push({
                id: Date.now(),
                text: `âœ… Ø§Ù†ØªÙ‚Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯: ${tr.playerName} Ø§Ø² ${tr.from} Ø¨Ù‡ ${tr.to}`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            renderAdmin(document.getElementById('app'));
            showTab('pendingtransfers');
        }

        function rejectPendingTransfer(id) {
            if (!app.pendingTransfers) return;
            const tr = app.pendingTransfers.find(t => t.id === id);
            if (!tr) return;
            
            tr.status = 'rejected';
            
            app.notifications.push({
                id: Date.now(),
                text: `âŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø±Ø¯ Ø´Ø¯: ${tr.playerName} Ø§Ø² ${tr.from} Ø¨Ù‡ ${tr.to}`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            renderAdmin(document.getElementById('app'));
            showTab('pendingtransfers');
        }

        function renderSettings(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¸Ø§Ù‡Ø±ÛŒ</h2>
                    
                    <div class="settings-section">
                        <div class="settings-title">ğŸ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù„ÛŒÚ¯</div>
                        <div class="form-group">
                            <label>Ù†Ø§Ù… Ù„ÛŒÚ¯</label>
                            <input type="text" id="leagueName" value="${app.settings.leagueName || 'Ù„ÛŒÚ¯ ÙÙˆØªØ¨Ø§Ù„'}" placeholder="Ù†Ø§Ù… Ù„ÛŒÚ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                        </div>
                        <button class="btn" onclick="saveLeagueName()">Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù…</button>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">ğŸ–¼ï¸ Ù„ÙˆÚ¯ÙˆÛŒ Ù„ÛŒÚ¯</div>
                        <div class="form-group">
                            <label>Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ± Ù„ÙˆÚ¯Ùˆ (URL)</label>
                            <input type="url" id="logoImg" value="${app.settings.logoImage || ''}" placeholder="https://example.com/logo.png">
                        </div>
                        ${app.settings.logoImage ? `<img src="${app.settings.logoImage}" style="width:80px;height:80px;object-fit:contain;border-radius:50%;margin:10px 0;display:block;">` : ''}
                        <button class="btn" onclick="applyLogo()">Ø°Ø®ÛŒØ±Ù‡ Ù„ÙˆÚ¯Ùˆ</button>
                        ${app.settings.logoImage ? `<button class="btn btn-danger" style="margin-right:10px;" onclick="removeLogo()">Ø­Ø°Ù Ù„ÙˆÚ¯Ùˆ</button>` : ''}
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">Ø±Ù†Ú¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§</div>
                        <div class="color-picker-group">
                            <div class="form-group">
                                <label>Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ Ø¯Ú©Ù…Ù‡</label>
                                <input type="color" id="btnColor1" value="${app.settings.buttonColor}">
                            </div>
                            <div class="form-group">
                                <label>Ø±Ù†Ú¯ Ø«Ø§Ù†ÙˆÛŒÙ‡ Ø¯Ú©Ù…Ù‡</label>
                                <input type="color" id="btnColor2" value="${app.settings.buttonSecondColor}">
                            </div>
                        </div>
                        <button class="btn" onclick="applyButtonColors()">Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯â€ŒÙ‡Ø§</button>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">ğŸ¨ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</div>
                        <div class="form-group">
                            <label>Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ (URL)</label>
                            <input type="url" id="bgImg" value="${app.settings.bgImage || ''}" placeholder="https://example.com/background.jpg">
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Ø±Ù†Ú¯ 1 (Ø§Ú¯Ù‡ Ø¹Ú©Ø³ Ù†Ø¨Ø§Ø´Ù‡)</label><input type="color" id="bgColor1" value="${app.settings.bgColor1 || '#0a0e27'}"></div>
                            <div class="form-group"><label>Ø±Ù†Ú¯ 2 (Ø§Ú¯Ù‡ Ø¹Ú©Ø³ Ù†Ø¨Ø§Ø´Ù‡)</label><input type="color" id="bgColor2" value="${app.settings.bgColor2 || '#2a1f3a'}"></div>
                        </div>
                        <button class="btn" onclick="applyBg()">Ø§Ø¹Ù…Ø§Ù„ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</button>
                        ${app.settings.bgImage ? `<button class="btn btn-danger" style="margin-right:10px;" onclick="removeBg()">Ø­Ø°Ù Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</button>` : ''}
                    </div>
                </div>
            `;
        }

        function saveLeagueName() {
            app.settings.leagueName = document.getElementById('leagueName').value.trim() || 'Ù„ÛŒÚ¯ ÙÙˆØªØ¨Ø§Ù„';
            saveData();
            alert('Ù†Ø§Ù… Ù„ÛŒÚ¯ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }

        function applyLogo() {
            const logoUrl = document.getElementById('logoImg').value.trim();
            app.settings.logoImage = logoUrl;
            saveData();
            renderSettings(document.getElementById('content'));
            alert('Ù„ÙˆÚ¯Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
        }

        function removeLogo() {
            app.settings.logoImage = '';
            saveData();
            renderSettings(document.getElementById('content'));
        }

        function removeBg() {
            app.settings.bgImage = '';
            document.body.style.background = `linear-gradient(135deg, ${app.settings.bgColor1 || '#0a0e27'} 0%, ${app.settings.bgColor2 || '#2a1f3a'} 100%)`;
            saveData();
            renderSettings(document.getElementById('content'));
        }

        function applyButtonColors() {
            const color1 = document.getElementById('btnColor1').value;
            const color2 = document.getElementById('btnColor2').value;
            
            app.settings.buttonColor = color1;
            app.settings.buttonSecondColor = color2;
            
            const style = document.createElement('style');
            style.innerHTML = `
                .btn { background: linear-gradient(135deg, ${color1} 0%, ${color2} 100%) !important; }
                .nav-tab.active { background: linear-gradient(135deg, ${color1} 0%, ${color2} 100%) !important; }
                .role-btn.active { background: linear-gradient(135deg, ${color1} 0%, ${color2} 100%) !important; }
                .login-btn { background: linear-gradient(135deg, ${color1} 0%, ${color2} 100%) !important; }
            `;
            document.head.appendChild(style);
            
            saveData();
            alert('Ø±Ù†Ú¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯');
        }

        function applyBg() {
            const img = document.getElementById('bgImg').value.trim();
            const c1 = document.getElementById('bgColor1').value;
            const c2 = document.getElementById('bgColor2').value;
            
            app.settings.bgImage = img;
            app.settings.bgColor1 = c1;
            app.settings.bgColor2 = c2;
            
            if (img) {
                document.body.style.backgroundImage = `url('${img}')`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundPosition = 'center';
            } else {
                document.body.style.backgroundImage = '';
                document.body.style.background = `linear-gradient(135deg, ${c1} 0%, ${c2} 100%)`;
            }
            
            saveData();
            renderSettings(document.getElementById('content'));
            alert('Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯');
        }

        function renderStandings(c) {
            // ØªÛŒÙ… Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù†ÛŒØ³Øª
            const allTeams = [...app.teams].filter(t => t.name !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ');
            
            // Ø§Ú¯Ø± Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù†Ø¯ØŒ Ø¬Ø¯ÙˆÙ„ Ú¯Ø±ÙˆÙ‡ÛŒ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡
            if (app.groups && Object.keys(app.groups).length > 0) {
                let groupsHtml = '';
                Object.keys(app.groups).forEach(groupName => {
                    const groupTeamNames = app.groups[groupName];
                    const groupTeams = groupTeamNames.map(name => {
                        return allTeams.find(t => t.name === name) || { name, w:0, d:0, l:0, gf:0, ga:0, p:0 };
                    }).sort((a, b) => {
                        if (b.p !== a.p) return b.p - a.p;
                        const diffA = a.gf - a.ga;
                        const diffB = b.gf - b.ga;
                        if (diffB !== diffA) return diffB - diffA;
                        return b.gf - a.gf;
                    });
                    
                    groupsHtml += `
                        <div class="card" style="margin-bottom: 20px;">
                            <h3 style="color:#1eff00; margin-bottom:15px;">${groupName}</h3>
                            <table class="data-table">
                                <thead><tr><th>Ø±ØªØ¨Ù‡</th><th>ØªÛŒÙ…</th><th>Ø¨Ø§Ø²ÛŒ</th><th>Ø¨Ø±Ø¯</th><th>Ù…Ø³Ø§ÙˆÛŒ</th><th>Ø¨Ø§Ø®Øª</th><th>Ú¯Ù„ Ø²Ø¯Ù‡</th><th>Ú¯Ù„ Ø®ÙˆØ±Ø¯Ù‡</th><th>ØªÙØ§Ø¶Ù„</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr></thead>
                                <tbody>${groupTeams.map((t, i) => `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td style="text-align:right;font-weight:600;">${t.name}</td>
                                        <td>${t.w + t.d + t.l}</td>
                                        <td>${t.w}</td>
                                        <td>${t.d}</td>
                                        <td>${t.l}</td>
                                        <td>${t.gf}</td>
                                        <td>${t.ga}</td>
                                        <td style="color:${t.gf - t.ga > 0 ? '#1eff00' : t.gf - t.ga < 0 ? '#ff5050' : '#fff'}">${t.gf - t.ga > 0 ? '+' : ''}${t.gf - t.ga}</td>
                                        <td style="font-weight:700;color:#1eff00;">${t.p}</td>
                                    </tr>
                                `).join('')}</tbody>
                            </table>
                        </div>
                    `;
                });
                
                c.innerHTML = `
                    <div class="card">
                        <h2 class="card-title">Ø¬Ø¯ÙˆÙ„ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ</h2>
                    </div>
                    ${groupsHtml}
                `;
            } else {
                // Ø¬Ø¯ÙˆÙ„ Ø¹Ø§Ø¯ÛŒ
                const sorted = allTeams.sort((a, b) => {
                    if (b.p !== a.p) return b.p - a.p;
                    const diffA = a.gf - a.ga;
                    const diffB = b.gf - b.ga;
                    if (diffB !== diffA) return diffB - diffA;
                    return b.gf - a.gf;
                });
                
                c.innerHTML = `
                    <div class="card">
                        <h2 class="card-title">Ø¬Ø¯ÙˆÙ„ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</h2>
                        ${sorted.length === 0 ? '<p style="color:#b0b0b0;">ØªÛŒÙ…ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : `
                            <table class="data-table">
                                <thead><tr><th>Ø±ØªØ¨Ù‡</th><th>ØªÛŒÙ…</th><th>Ø¨Ø§Ø²ÛŒ</th><th>Ø¨Ø±Ø¯</th><th>Ù…Ø³Ø§ÙˆÛŒ</th><th>Ø¨Ø§Ø®Øª</th><th>Ú¯Ù„ Ø²Ø¯Ù‡</th><th>Ú¯Ù„ Ø®ÙˆØ±Ø¯Ù‡</th><th>ØªÙØ§Ø¶Ù„</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr></thead>
                                <tbody>${sorted.map((t, i) => `
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td style="text-align:right;font-weight:600;">${t.name}</td>
                                        <td>${t.w + t.d + t.l}</td>
                                        <td>${t.w}</td>
                                        <td>${t.d}</td>
                                        <td>${t.l}</td>
                                        <td>${t.gf}</td>
                                        <td>${t.ga}</td>
                                        <td style="color:${t.gf - t.ga > 0 ? '#1eff00' : t.gf - t.ga < 0 ? '#ff5050' : '#fff'}">${t.gf - t.ga > 0 ? '+' : ''}${t.gf - t.ga}</td>
                                        <td style="font-weight:700;color:#1eff00;">${t.p}</td>
                                    </tr>
                                `).join('')}</tbody>
                            </table>
                        `}
                    </div>
                `;
            }
        }

        function renderMatchesView(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h2>
                    ${app.matches.length === 0 ? '<p style="color:#b0b0b0;">Ù…Ø³Ø§Ø¨Ù‚Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : app.matches.map(m => `
                        <div class="match-card">
                            <div class="match-teams">
                                <span class="team-name">${m.home}</span>
                                <span class="match-score">${m.homeScore} - ${m.awayScore}</span>
                                <span class="team-name">${m.away}</span>
                            </div>
                            ${m.scorers ? `<div style="color:#b0b0b0;margin-top:10px;">Ú¯Ù„Ø²Ù†Ø§Ù†: ${m.scorers}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderBudgetView(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø¨ÙˆØ¯Ø¬Ù‡ ØªÛŒÙ…â€ŒÙ‡Ø§</h2>
                    ${app.budgets.length === 0 ? '<p style="color:#b0b0b0;">Ø¨ÙˆØ¯Ø¬Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : `
                        <table class="data-table">
                            <thead><tr><th>ØªÛŒÙ…</th><th>Ø¨ÙˆØ¯Ø¬Ù‡ (ÛŒÙˆØ±Ùˆ)</th></tr></thead>
                            <tbody>${app.budgets.map(b => `<tr><td>${b.team}</td><td>${b.budget.toLocaleString()}</td></tr>`).join('')}</tbody>
                        </table>
                    `}
                </div>
            `;
        }

        function renderTransfersView(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</h2>
                    ${app.transfers.length === 0 ? '<p style="color:#b0b0b0;">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : app.transfers.map(tr => `
                        <div class="transfer-card">
                            ${tr.img ? `<img src="${tr.img}" class="transfer-image" alt="${tr.player}">` : ''}
                            <div class="transfer-details">
                                <div class="transfer-player">${tr.player}</div>
                                <div class="transfer-route">${tr.from} â†’ ${tr.to}</div>
                                <div class="transfer-price">${tr.amount.toLocaleString()} ÛŒÙˆØ±Ùˆ â€¢ ${tr.duration} Ø³Ø§Ù„</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderMyTeam(c) {
            const teamData = Object.values(app.userTeams).find(t => t.name === app.team);
            const teamPlayers = app.players.filter(p => p.team === app.team);
            const teamMatches = app.matches.filter(m => m.home === app.team || m.away === app.team).slice(-5);
            const teamBudget = app.budgets.find(b => b.team === app.team);
            // Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¢Ø²Ø§Ø¯ Ø¯Ø± ØªÛŒÙ… Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ
            const freePlayers = app.players.filter(p => p.team === 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ');
            // Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø³Ø§ÛŒØ± ØªÛŒÙ…â€ŒÙ‡Ø§
            const otherPlayers = app.players.filter(p => p.team !== app.team && p.team !== 'Ø¢Ø²Ø§Ø¯ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ');
            const allTransferPlayers = [...freePlayers, ...otherPlayers];
            
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">ØªÛŒÙ… Ù…Ù†: ${app.team}</h2>
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-value">${teamPlayers.length}</div><div class="stat-label">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</div></div>
                        <div class="stat-box"><div class="stat-value">${teamMatches.length}</div><div class="stat-label">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ø®ÛŒØ±</div></div>
                        <div class="stat-box"><div class="stat-value">${teamBudget ? teamBudget.budget.toLocaleString() : '0'}</div><div class="stat-label">Ø¨ÙˆØ¯Ø¬Ù‡ (ÛŒÙˆØ±Ùˆ)</div></div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¬Ø¯ÛŒØ¯</h2>
                    <div class="form-row">
                        <div class="form-group"><label>Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†</label><input type="text" id="newPlayerName"></div>
                        <div class="form-group"><label>Ù¾Ø³Øª</label><select id="newPlayerPos"><option>GK</option><option>DF</option><option>MF</option><option>FW</option></select></div>
                        <div class="form-group"><label>Overall</label><input type="number" id="newPlayerOverall" min="1" max="99" value="75"></div>
                    </div>
                    <button class="btn" onclick="requestAddPlayer()">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ÙØ²ÙˆØ¯Ù†</button>
                </div>
                
                <div class="card" style="border-color:rgba(255,165,0,0.3);">
                    <h2 class="card-title" style="color:#ffa500;">ğŸ”„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ (ØºÛŒØ±Ø±Ø³Ù…ÛŒ)</h2>
                    <p style="color:#b0b0b0;margin-bottom:15px;">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ÙÙ‚Ø· Ù¾Ø³ Ø§Ø² ØªØ£ÛŒÛŒØ¯ Ø±Ø³Ù…ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±</label>
                            <select id="reqTransferPlayer">
                                <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù† --</option>
                                ${allTransferPlayers.map(p => `<option value="${p.id}" data-name="${p.name}" data-team="${p.team}">${p.name} (${p.team})</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group"><label>Ù…Ø¨Ù„Øº Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ (ÛŒÙˆØ±Ùˆ)</label><input type="number" id="reqTransferAmount" min="0" value="0"></div>
                        <div class="form-group"><label>Ù…Ø¯Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Ø³Ø§Ù„)</label><input type="number" id="reqTransferDuration" min="1" max="10" value="3"></div>
                    </div>
                    <button class="btn" onclick="requestTransfer()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†</button>
                    
                    ${(app.pendingTransfers || []).filter(t => t.requestedBy === app.team).length > 0 ? `
                        <div style="margin-top:20px;">
                            <strong style="color:#1eff00;">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†:</strong>
                            ${(app.pendingTransfers || []).filter(t => t.requestedBy === app.team).map(t => `
                                <div style="padding:10px;background:rgba(255,255,255,0.05);border-radius:10px;margin-top:10px;">
                                    <span>${t.playerName}</span> 
                                    <span style="color:#888;margin:0 10px;">â†’</span>
                                    <span style="color:#1eff00;">${app.team}</span>
                                    <span class="pending-badge" style="margin-right:10px;">${t.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±' : t.status === 'approved' ? 'âœ… ØªØ£ÛŒÛŒØ¯' : 'âŒ Ø±Ø¯'}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                
                <div class="card">
                    <h2 class="card-title">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ØªÛŒÙ…</h2>
                    ${teamPlayers.length === 0 ? '<p style="color:#b0b0b0;">Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : teamPlayers.map(p => `
                        <div class="player-card">
                            <div class="player-info">
                                <div class="player-name">${p.name}</div>
                                <div class="player-details">${p.position} â€¢ Overall: ${p.overall}</div>
                            </div>
                            <div class="player-overall">${p.overall}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="card">
                    <h2 class="card-title">ØªØºÛŒÛŒØ± ØªØ§Ú©ØªÛŒÚ©</h2>
                    <div class="form-group"><label>Ú†ÛŒÙ†Ø´</label><select id="formation"><option>4-3-3</option><option>4-4-2</option><option>3-5-2</option><option>4-2-3-1</option></select></div>
                    <div class="form-group"><label>Ø´ÛŒÙˆÙ‡ Ø¨Ø§Ø²ÛŒ</label><select id="tactics"><option>ØªÙ‡Ø§Ø¬Ù…ÛŒ</option><option>Ù…ØªØ¹Ø§Ø¯Ù„</option><option>Ø¯ÙØ§Ø¹ÛŒ</option></select></div>
                    <div class="form-group"><label>Ù¾ÛŒØ§Ù… ØªØ§Ú©ØªÛŒÚ©</label><textarea id="tacticMsg" rows="4" placeholder="ØªØºÛŒÛŒØ±Ø§Øª ØªØ§Ú©ØªÛŒÚ©ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯"></textarea></div>
                    <button class="btn" onclick="submitTactics()">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†</button>
                </div>
            `;
        }

        function requestAddPlayer() {
            const name = document.getElementById('newPlayerName').value.trim();
            const position = document.getElementById('newPlayerPos').value;
            const overall = parseInt(document.getElementById('newPlayerOverall').value);
            
            if (!name) {
                alert('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            app.pendingPlayers.push({
                id: Date.now(),
                name,
                team: app.team,
                position,
                overall
            });
            
            app.notifications.push({
                id: Date.now(),
                text: `Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù† ${name} Ø§Ø² ØªÛŒÙ… ${app.team}`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
            showTeamTab('myteam');
        }

        function requestTransfer() {
            const playerSelect = document.getElementById('reqTransferPlayer');
            const playerId = parseInt(playerSelect.value);
            const playerName = playerSelect.options[playerSelect.selectedIndex].getAttribute('data-name');
            const playerFromTeam = playerSelect.options[playerSelect.selectedIndex].getAttribute('data-team');
            const amount = parseInt(document.getElementById('reqTransferAmount').value) || 0;
            const duration = parseInt(document.getElementById('reqTransferDuration').value) || 1;
            
            if (!playerId || !playerName) {
                alert('Ù„Ø·ÙØ§ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            if (!app.pendingTransfers) app.pendingTransfers = [];
            
            app.pendingTransfers.push({
                id: Date.now(),
                playerId,
                playerName,
                from: playerFromTeam,
                to: app.team,
                amount,
                duration,
                requestedBy: app.team,
                status: 'pending',
                time: new Date().toLocaleString('fa-IR')
            });
            
            app.notifications.push({
                id: Date.now(),
                text: `ğŸ”„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„: ØªÛŒÙ… ${app.team} Ø®ÙˆØ§Ø³ØªØ§Ø± Ø¬Ø°Ø¨ ${playerName} (Ø§Ø² ${playerFromTeam}) Ø¨Ù‡ Ù…Ø¨Ù„Øº ${amount.toLocaleString()} ÛŒÙˆØ±Ùˆ`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            alert('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ø¨Ø§Ø´ÛŒØ¯.');
            showTeamTab('myteam');
        }

        function submitTactics() {
            const formation = document.getElementById('formation').value;
            const tactics = document.getElementById('tactics').value;
            const msg = document.getElementById('tacticMsg').value.trim();
            
            app.notifications.push({
                id: Date.now(),
                text: `ØªØºÛŒÛŒØ± ØªØ§Ú©ØªÛŒÚ© ${app.team}: ${formation} - ${tactics}${msg ? ' - ' + msg : ''}`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            alert('ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }

        function renderAIAssistant(c) {
            const messages = app.chatHistory || [];
            
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">ğŸ¤– Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù„ÛŒÚ¯</h2>
                    <p style="color:#b0b0b0;margin-bottom:20px;">Ø³ÙˆØ§Ù„Ø§Øª Ø®ÙˆØ¯ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù„ÛŒÚ¯ØŒ ØªÛŒÙ…â€ŒÙ‡Ø§ØŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ùˆ ØªØ§Ú©ØªÛŒÚ©â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯</p>
                    
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            ${messages.map(m => `
                                <div class="chat-message ${m.role}">
                                    <strong>${m.role === 'user' ? 'Ø´Ù…Ø§' : 'Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯'}:</strong>
                                    <p style="margin-top:8px;">${m.text}</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="chat-input-area">
                            <input type="text" id="chatInput" class="chat-input" placeholder="Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯..." onkeypress="if(event.key==='Enter') sendMessage()">
                            <button class="btn" onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px;padding:20px;background:rgba(30,255,0,0.05);border-radius:15px;border:1px solid rgba(30,255,0,0.2);">
                        <strong style="color:#1eff00;">Ø³ÙˆØ§Ù„Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:</strong>
                        <div style="margin-top:15px;display:grid;gap:10px;">
                            <button class="btn btn-secondary" onclick="askPredefined('ÙˆØ¶Ø¹ÛŒØª ØªÛŒÙ… Ù…Ù† Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ú†Ú¯ÙˆÙ†Ù‡ Ø§Ø³ØªØŸ')">ÙˆØ¶Ø¹ÛŒØª ØªÛŒÙ… Ù…Ù† Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ú†Ú¯ÙˆÙ†Ù‡ Ø§Ø³ØªØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ØªÛŒÙ… Ù…Ù† Ú†Ù‡ Ú©Ø³Ø§Ù†ÛŒ Ù‡Ø³ØªÙ†Ø¯ØŸ')">Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ØªÛŒÙ… Ù…Ù† Ú†Ù‡ Ú©Ø³Ø§Ù†ÛŒ Ù‡Ø³ØªÙ†Ø¯ØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ú†Ù‡ ØªØ§Ú©ØªÛŒÚ©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ')">Ú†Ù‡ ØªØ§Ú©ØªÛŒÚ©ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù ØªÛŒÙ… Ù…Ù† Ú©Ø¬Ø§Ø³ØªØŸ')">Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù ØªÛŒÙ… Ù…Ù† Ú©Ø¬Ø§Ø³ØªØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ø¢Ù…Ø§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ø®ÛŒØ± Ù…Ù† Ú†Ø·ÙˆØ± Ø¨ÙˆØ¯Ù‡ØŸ')">Ø¢Ù…Ø§Ø± Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ø®ÛŒØ± Ù…Ù† Ú†Ø·ÙˆØ± Ø¨ÙˆØ¯Ù‡ØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ú©Ø¯Ø§Ù… Ù¾Ø³Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ‚ÙˆÛŒØª Ø¯Ø§Ø±Ø¯ØŸ')">Ú©Ø¯Ø§Ù… Ù¾Ø³Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ‚ÙˆÛŒØª Ø¯Ø§Ø±Ø¯ØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ø¨Ø±Ø§ÛŒ ØµØ¯Ø±Ù†Ø´ÛŒÙ†ÛŒ Ú†Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ú©Ù†Ù…ØŸ')">Ø¨Ø±Ø§ÛŒ ØµØ¯Ø±Ù†Ø´ÛŒÙ†ÛŒ Ú†Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ú©Ù†Ù…ØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ø¨ÙˆØ¯Ø¬Ù‡ Ù…Ù† Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ')">Ø¨ÙˆØ¯Ø¬Ù‡ Ù…Ù† Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ù…Ù‚Ø§ÛŒØ³Ù‡ ØªÛŒÙ… Ù…Ù† Ø¨Ø§ Ø­Ø±ÛŒÙØ§Ù†')">Ù…Ù‚Ø§ÛŒØ³Ù‡ ØªÛŒÙ… Ù…Ù† Ø¨Ø§ Ø­Ø±ÛŒÙØ§Ù†</button>
                            <button class="btn btn-secondary" onclick="askPredefined('ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯')">ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø±Ø¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ÛŒ')">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø±Ø¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ÛŒ</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ù†Ù‚Ø§Ø· Ù‚ÙˆØª ØªÛŒÙ… Ù…Ù†')">Ù†Ù‚Ø§Ø· Ù‚ÙˆØª ØªÛŒÙ… Ù…Ù†</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù†ØªÛŒØ¬Ù‡ Ù„ÛŒÚ¯')">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù†ØªÛŒØ¬Ù‡ Ù„ÛŒÚ¯</button>
                            <button class="btn btn-secondary" onclick="askPredefined('Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÛŒÙ…')">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÛŒÙ…</button>
                            <button class="btn btn-secondary" onclick="askPredefined('ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØµÙ„')">ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØµÙ„</button>
                        </div>
                    </div>
                </div>
            `;
            
            scrollChatToBottom();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!app.chatHistory) app.chatHistory = [];
            
            app.chatHistory.push({ role: 'user', text: message });
            input.value = '';
            
            const response = generateAIResponse(message);
            app.chatHistory.push({ role: 'ai', text: response });
            
            saveData();
            renderAIAssistant(document.getElementById('content'));
        }

        function askPredefined(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        function generateAIResponse(message) {
            const msg = message.toLowerCase();
            const myTeam = app.teams.find(t => t.name === app.team);
            const myPlayers = app.players.filter(p => p.team === app.team);
            const myMatches = app.matches.filter(m => m.home === app.team || m.away === app.team);
            const myBudget = app.budgets.find(b => b.team === app.team);
            
            const sorted = [...app.teams].sort((a, b) => b.p - a.p);
            const myRank = sorted.findIndex(t => t.name === app.team) + 1;
            
            if (msg.includes('Ø¬Ø¯ÙˆÙ„') || msg.includes('ÙˆØ¶Ø¹ÛŒØª') || msg.includes('Ø±ØªØ¨Ù‡')) {
                return `ØªÛŒÙ… ${app.team} Ø¯Ø± Ø±ØªØ¨Ù‡ ${myRank} Ø¬Ø¯ÙˆÙ„ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯ Ø¨Ø§ ${myTeam.p} Ø§Ù…ØªÛŒØ§Ø². Ø´Ù…Ø§ ${myTeam.w} Ø¨Ø±Ø¯ØŒ ${myTeam.d} Ù…Ø³Ø§ÙˆÛŒ Ùˆ ${myTeam.l} Ø¨Ø§Ø®Øª Ø¯Ø§Ø´ØªÙ‡â€ŒØ§ÛŒØ¯. ØªÙØ§Ø¶Ù„ Ú¯Ù„ Ø´Ù…Ø§ ${myTeam.gf - myTeam.ga} Ø§Ø³Øª.`;
            }
            
            if (msg.includes('Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†') || msg.includes('Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¨Ø±ØªØ±')) {
                const topPlayers = myPlayers.sort((a, b) => b.overall - a.overall).slice(0, 3);
                return `Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø´Ù…Ø§: ${topPlayers.map(p => `${p.name} (${p.overall})`).join('ØŒ ')}. Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø³ØªÙˆÙ† Ø§ØµÙ„ÛŒ ØªÛŒÙ… Ø´Ù…Ø§ Ù‡Ø³ØªÙ†Ø¯.`;
            }
            
            if (msg.includes('ØªØ§Ú©ØªÛŒÚ©') || msg.includes('Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ')) {
                return `Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ ØªØ±Ú©ÛŒØ¨ ØªÛŒÙ… Ø´Ù…Ø§ØŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø§Ø² Ú†ÛŒÙ†Ø´ 4-3-3 ØªÙ‡Ø§Ø¬Ù…ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯. Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø´Ù…Ø§ Ø¯Ø± Ø®Ø· Ø­Ù…Ù„Ù‡ ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø§Ø±Ù†Ø¯. Ø±ÙˆÛŒ ÙØ´Ø§Ø± Ø¨Ø§Ù„Ø§ Ùˆ Ø¨Ø§Ø²ÛŒ Ø³Ø±ÛŒØ¹ ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒØ¯.`;
            }
            
            if (msg.includes('Ù†Ù‚Ø·Ù‡ Ø¶Ø¹Ù') || msg.includes('Ø¶Ø¹Ù')) {
                const positions = { GK: 0, DF: 0, MF: 0, FW: 0 };
                myPlayers.forEach(p => positions[p.position]++);
                const weak = Object.entries(positions).sort((a, b) => a[1] - b[1])[0];
                return `Ù†Ù‚Ø·Ù‡ Ø¶Ø¹Ù Ø§ØµÙ„ÛŒ ØªÛŒÙ… Ø´Ù…Ø§ Ú©Ù…Ø¨ÙˆØ¯ Ø¯Ø± Ù¾Ø³Øª ${weak[0]} Ø§Ø³Øª. ÙÙ‚Ø· ${weak[1]} Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± Ø§ÛŒÙ† Ù¾Ø³Øª Ø¯Ø§Ø±ÛŒØ¯. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø¯Ø± Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ø¢ÛŒÙ†Ø¯Ù‡ Ø±ÙˆÛŒ Ø§ÛŒÙ† Ù¾Ø³Øª ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒØ¯.`;
            }
            
            if (msg.includes('Ù…Ø³Ø§Ø¨Ù‚Ø§Øª') || msg.includes('Ø¢Ù…Ø§Ø±')) {
                const recent = myMatches.slice(-3);
                const wins = recent.filter(m => 
                    (m.home === app.team && m.homeScore > m.awayScore) || 
                    (m.away === app.team && m.awayScore > m.homeScore)
                ).length;
                return `Ø¯Ø± ${recent.length} Ø¨Ø§Ø²ÛŒ Ø§Ø®ÛŒØ±ØŒ ${wins} Ø¨Ø±Ø¯ Ú©Ø³Ø¨ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´Ù…Ø§ ${wins > 1 ? 'Ø®ÙˆØ¨' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¯Ø§Ø±Ø¯'}. Ø¯Ø± Ú©Ù„ ${myMatches.length} Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯.`;
            }
            
            if (msg.includes('Ù¾Ø³Øª') || msg.includes('ØªÙ‚ÙˆÛŒØª')) {
                const avgByPos = {};
                ['GK', 'DF', 'MF', 'FW'].forEach(pos => {
                    const players = myPlayers.filter(p => p.position === pos);
                    avgByPos[pos] = players.length > 0 ? 
                        players.reduce((sum, p) => sum + p.overall, 0) / players.length : 0;
                });
                const weakPos = Object.entries(avgByPos).sort((a, b) => a[1] - b[1])[0];
                return `Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ­Ù„ÛŒÙ„ØŒ Ù¾Ø³Øª ${weakPos[0]} Ø¨Ø§ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ${weakPos[1].toFixed(1)} Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ‚ÙˆÛŒØª Ø¯Ø§Ø±Ø¯. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ Ø¨Ø§ overall Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² 80 Ø¯Ø± Ø§ÛŒÙ† Ù¾Ø³Øª Ø¬Ø°Ø¨ Ú©Ù†ÛŒØ¯.`;
            }
            
            if (msg.includes('ØµØ¯Ø±Ù†Ø´ÛŒÙ†') || msg.includes('Ù‚Ù‡Ø±Ù…Ø§Ù†')) {
                const gap = sorted[0].p - myTeam.p;
                return gap === 0 ? 
                    'Ø´Ù…Ø§ Ø¯Ø± ØµØ¯Ø± Ø¬Ø¯ÙˆÙ„ Ù‡Ø³ØªÛŒØ¯! Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ Ø§ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØªØŒ Ø±ÙˆÛŒ Ø«Ø¨Ø§Øª Ùˆ Ø¹Ø¯Ù… Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¯ÙØ§Ø¹ÛŒ ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒØ¯.' :
                    `ÙØ§ØµÙ„Ù‡ Ø´Ù…Ø§ Ø¨Ø§ ØµØ¯Ø± ${gap} Ø§Ù…ØªÛŒØ§Ø² Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ ØµØ¯Ø± Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ø¨Ø±Ø¯ Ú©Ø³Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ù…ÛŒØ¯ÙˆØ§Ø± Ø¨Ø§Ø´ÛŒØ¯ ØµØ¯Ø±Ù†Ø´ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ø§Ø² Ø¯Ø³Øª Ø¨Ø¯Ù‡Ø¯.`;
            }
            
            if (msg.includes('Ø¨ÙˆØ¯Ø¬Ù‡') || msg.includes('Ù¾ÙˆÙ„')) {
                return `Ø¨ÙˆØ¯Ø¬Ù‡ ÙØ¹Ù„ÛŒ ØªÛŒÙ… Ø´Ù…Ø§ ${myBudget.budget.toLocaleString()} ÛŒÙˆØ±Ùˆ Ø§Ø³Øª. Ø§ÛŒÙ† Ø¨ÙˆØ¯Ø¬Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¬Ø°Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¬Ø¯ÛŒØ¯ ÛŒØ§ Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ù…Ú©Ø§Ù†Ø§Øª ØªÛŒÙ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.`;
            }
            
            if (msg.includes('Ù…Ù‚Ø§ÛŒØ³Ù‡') || msg.includes('Ø­Ø±ÛŒÙ')) {
                const top3 = sorted.slice(0, 3);
                return `Ø³Ù‡ ØªÛŒÙ… Ø¨Ø±ØªØ± Ù„ÛŒÚ¯: ${top3.map((t, i) => `${i+1}. ${t.name} (${t.p} Ø§Ù…ØªÛŒØ§Ø²)`).join('ØŒ ')}. ${
                    myRank <= 3 ? 'Ø´Ù…Ø§ Ø¯Ø± Ø¨ÛŒÙ† ØªÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø±ØªØ± Ù‡Ø³ØªÛŒØ¯!' : 
                    'Ø¨Ø±Ø§ÛŒ Ø±Ù‚Ø§Ø¨Øª Ø¨Ø§ Ø¢Ù†â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¯Ù‡ÛŒØ¯.'
                }`;
            }
            
            if (msg.includes('Ø®Ø±ÛŒØ¯') || msg.includes('Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„')) {
                return `Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø¨Ø§Ø²ÛŒÚ©Ù†ØŒ Ø§Ø¨ØªØ¯Ø§ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù ØªÛŒÙ… Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ú©Ù†ÛŒØ¯. Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†ÛŒ Ø¨Ø§ overall Ø¨Ø§Ù„Ø§ÛŒ 80 Ø±Ø§ Ù‡Ø¯Ù Ø¨Ú¯ÛŒØ±ÛŒØ¯. Ù‡Ù…Ú†Ù†ÛŒÙ† ØªÙˆØ¬Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ú©Ù‡ Ø¨ÙˆØ¯Ø¬Ù‡ Ú©Ø§ÙÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.`;
            }
            
            if (msg.includes('Ø¨Ø±Ø¯') || msg.includes('Ù¾ÛŒØ±ÙˆØ²')) {
                return `Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡: 1) Ø§Ø² Ø¨Ù‡ØªØ±ÛŒÙ† ØªØ±Ú©ÛŒØ¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ 2) ØªØ§Ú©ØªÛŒÚ© Ù…Ù†Ø§Ø³Ø¨ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ 3) Ø±ÙˆÛŒ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒØ¯ 4) Ø§Ø² Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø¯ÙØ§Ø¹ÛŒ Ø¨Ù¾Ø±Ù‡ÛŒØ²ÛŒØ¯`;
            }
            
            if (msg.includes('Ù†Ù‚Ø·Ù‡ Ù‚ÙˆØª') || msg.includes('Ù‚ÙˆØª')) {
                const bestPlayers = myPlayers.sort((a, b) => b.overall - a.overall).slice(0, 3);
                return `Ù†Ù‚Ø§Ø· Ù‚ÙˆØª ØªÛŒÙ… Ø´Ù…Ø§: Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ú©Ù„ÛŒØ¯ÛŒ Ù‚ÙˆÛŒ (${bestPlayers.map(p => p.name).join('ØŒ ')})ØŒ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ú©Ø§ÙÛŒ (${myPlayers.length} Ù†ÙØ±)`;
            }
            
            if (msg.includes('Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ') || msg.includes('Ø¢ÛŒÙ†Ø¯Ù‡')) {
                return myRank <= 3 ? 
                    'Ø¨Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ø§ÛŒÙ† Ø±ÙˆÙ†Ø¯ØŒ Ø´Ø§Ù†Ø³ Ø®ÙˆØ¨ÛŒ Ø¨Ø±Ø§ÛŒ Ù‚Ù‡Ø±Ù…Ø§Ù†ÛŒ ÛŒØ§ Ú©Ø³Ø¨ Ù…Ø¯Ø§Ù„ Ø¯Ø§Ø±ÛŒØ¯. Ø­ÙØ¸ Ø«Ø¨Ø§Øª Ú©Ù„ÛŒØ¯ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø³Øª.' :
                    'Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø±ØªØ¨Ù‡ØŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ØªØ±ÛŒ Ú©Ø³Ø¨ Ú©Ù†ÛŒØ¯. ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø§Ø®Øª Ù…Ù‡Ù… Ø§Ø³Øª.';
            }
            
            if (msg.includes('Ø±Ø§Ù‡Ù†Ù…Ø§') || msg.includes('Ú©Ù…Ú©')) {
                return `Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªÛŒÙ…: 1) Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¬Ø°Ø¨ Ú©Ù†ÛŒØ¯ 2) ØªØ§Ú©ØªÛŒÚ© Ù…Ù†Ø§Ø³Ø¨ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ 3) Ø¨ÙˆØ¯Ø¬Ù‡ Ø±Ø§ Ø¹Ø§Ù‚Ù„Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯ 4) Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø±Ø§ Ø²ÛŒØ± Ù†Ø¸Ø± Ø¨Ú¯ÛŒØ±ÛŒØ¯ 5) Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† Ù„ÛŒÚ¯ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ø´ÛŒØ¯`;
            }
            
            if (msg.includes('ØªØ­Ù„ÛŒÙ„') || msg.includes('Ø¹Ù…Ù„Ú©Ø±Ø¯')) {
                const winRate = ((myTeam.w / (myTeam.w + myTeam.d + myTeam.l)) * 100).toFixed(1);
                return `ØªØ­Ù„ÛŒÙ„ Ø¹Ù…Ù„Ú©Ø±Ø¯: Ø¯Ø±ØµØ¯ Ø¨Ø±Ø¯ ${winRate}%ØŒ ØªÙØ§Ø¶Ù„ Ú¯Ù„ ${myTeam.gf - myTeam.ga}ØŒ Ø±ØªØ¨Ù‡ ${myRank} Ø§Ø² ${app.teams.length}. ${
                    winRate > 50 ? 'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø±ÛŒØ¯!' : 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¯Ø§Ø±ÛŒØ¯.'
                }`;
            }
            
            return 'Ø³ÙˆØ§Ù„ Ø¬Ø§Ù„Ø¨ÛŒ Ø§Ø³Øª! Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ù…Ø®ØªÙ„ÙÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªÛŒÙ…ØŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†ØŒ Ø¬Ø¯ÙˆÙ„ØŒ ØªØ§Ú©ØªÛŒÚ© Ùˆ Ø¨ÙˆØ¯Ø¬Ù‡ Ø¨Ù¾Ø±Ø³ÛŒØ¯. Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù‡Ù… Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.';
        }

        function scrollChatToBottom() {
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        function renderStats(c) {
            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ù„ÛŒÚ¯</h2>
                    <div class="stats-grid">
                        <div class="stat-box"><div class="stat-value">${app.teams.length}</div><div class="stat-label">ØªÛŒÙ…â€ŒÙ‡Ø§</div></div>
                        <div class="stat-box"><div class="stat-value">${app.players.length}</div><div class="stat-label">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</div></div>
                        <div class="stat-box"><div class="stat-value">${app.matches.length}</div><div class="stat-label">Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div></div>
                        <div class="stat-box"><div class="stat-value">${app.transfers.length}</div><div class="stat-label">Ù†Ù‚Ù„ Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</div></div>
                    </div>
                </div>
            `;
        }

        // Lineup Editor Functions
        const formations = {
            '4-4-2': [
                { pos: 'GK', x: 50, y: 95 },
                { pos: 'DF', x: 20, y: 75 },
                { pos: 'DF', x: 40, y: 75 },
                { pos: 'DF', x: 60, y: 75 },
                { pos: 'DF', x: 80, y: 75 },
                { pos: 'MF', x: 20, y: 50 },
                { pos: 'MF', x: 40, y: 50 },
                { pos: 'MF', x: 60, y: 50 },
                { pos: 'MF', x: 80, y: 50 },
                { pos: 'FW', x: 35, y: 20 },
                { pos: 'FW', x: 65, y: 20 }
            ],
            '4-3-3': [
                { pos: 'GK', x: 50, y: 95 },
                { pos: 'DF', x: 20, y: 75 },
                { pos: 'DF', x: 40, y: 75 },
                { pos: 'DF', x: 60, y: 75 },
                { pos: 'DF', x: 80, y: 75 },
                { pos: 'MF', x: 30, y: 50 },
                { pos: 'MF', x: 50, y: 50 },
                { pos: 'MF', x: 70, y: 50 },
                { pos: 'FW', x: 20, y: 20 },
                { pos: 'FW', x: 50, y: 20 },
                { pos: 'FW', x: 80, y: 20 }
            ],
            '3-5-2': [
                { pos: 'GK', x: 50, y: 95 },
                { pos: 'DF', x: 30, y: 75 },
                { pos: 'DF', x: 50, y: 75 },
                { pos: 'DF', x: 70, y: 75 },
                { pos: 'MF', x: 15, y: 50 },
                { pos: 'MF', x: 35, y: 50 },
                { pos: 'MF', x: 50, y: 50 },
                { pos: 'MF', x: 65, y: 50 },
                { pos: 'MF', x: 85, y: 50 },
                { pos: 'FW', x: 35, y: 20 },
                { pos: 'FW', x: 65, y: 20 }
            ],
            '4-2-3-1': [
                { pos: 'GK', x: 50, y: 95 },
                { pos: 'DF', x: 20, y: 75 },
                { pos: 'DF', x: 40, y: 75 },
                { pos: 'DF', x: 60, y: 75 },
                { pos: 'DF', x: 80, y: 75 },
                { pos: 'MF', x: 35, y: 60 },
                { pos: 'MF', x: 65, y: 60 },
                { pos: 'MF', x: 25, y: 40 },
                { pos: 'MF', x: 50, y: 40 },
                { pos: 'MF', x: 75, y: 40 },
                { pos: 'FW', x: 50, y: 20 }
            ]
        };

        let currentFormation = '4-4-2';
        let currentLineup = {};
        let selectedSlot = null;

        function renderLineupEditor(c) {
            if (!app.lineups[app.team]) {
                app.lineups[app.team] = { formation: '4-4-2', players: {} };
            }

            currentFormation = app.lineups[app.team].formation || '4-4-2';
            currentLineup = app.lineups[app.team].players || {};

            const teamPlayers = app.players.filter(p => p.team === app.team);

            c.innerHTML = `
                <div class="card">
                    <h2 class="card-title">âš½ ØªØ±Ú©ÛŒØ¨ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h2>
                    
                    <div class="formation-selector">
                        <strong style="color:#1eff00;">Ø§Ù†ØªØ®Ø§Ø¨ Ú†ÛŒÙ†Ø´:</strong>
                        ${Object.keys(formations).map(f => `
                            <div class="formation-btn ${f === currentFormation ? 'active' : ''}" onclick="changeFormation('${f}')">${f}</div>
                        `).join('')}
                    </div>

                    <div class="pitch-container" id="pitch">
                        <div class="pitch-lines">
                            <div class="halfway-line"></div>
                            <div class="center-circle"></div>
                            <div class="center-spot"></div>
                            <div class="penalty-box top"></div>
                            <div class="penalty-box bottom"></div>
                        </div>
                        ${renderPitchSlots()}
                    </div>

                    <div style="text-align:center; margin: 20px 0;">
                        <button class="btn" onclick="saveLineup()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØ±Ú©ÛŒØ¨</button>
                        <button class="btn btn-secondary" onclick="clearLineup()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
                        <button class="btn btn-secondary" onclick="autoFillLineup()">ğŸ¤– Ù¾Ø± Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø±</button>
                    </div>

                    <div class="player-list-selector">
                        <h3 style="color:#1eff00; margin-bottom:15px;">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯ (${teamPlayers.length})</h3>
                        ${teamPlayers.length === 0 ? '<p style="color:#b0b0b0;">Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : teamPlayers.map(p => {
                            const inLineup = Object.values(currentLineup).includes(p.id);
                            return `
                                <div class="player-item ${inLineup ? 'selected' : ''}" data-player-id="${p.id}">
                                    <div>
                                        <strong>${p.name}</strong>
                                        <span style="color:#b0b0b0; margin-left:10px;">${p.position} â€¢ ${p.overall}</span>
                                    </div>
                                    <div style="color:#1eff00; font-weight:700;">${p.overall}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div class="modal" id="playerModal">
                    <div class="modal-content">
                        <div class="modal-header">Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
                        <div id="modalPlayerList"></div>
                        <button class="modal-close" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
                    </div>
                </div>
            `;
        }

        function renderPitchSlots() {
            const slots = formations[currentFormation];
            return slots.map((slot, idx) => {
                const playerId = currentLineup[idx];
                const player = playerId ? app.players.find(p => p.id === playerId) : null;
                
                return `
                    <div class="player-slot ${player ? 'filled' : 'empty'}" 
                         style="left:${slot.x}%; top:${slot.y}%;"
                         onclick="openPlayerSelector(${idx}, '${slot.pos}')">
                        ${player ? `
                            <div class="player-number">${player.overall}</div>
                            <div class="player-short-name">${player.name.split(' ').pop()}</div>
                        ` : `
                            <div style="color:rgba(255,255,255,0.5); font-size:0.8em;">${slot.pos}</div>
                            <div style="color:rgba(255,255,255,0.3); font-size:0.7em;">+</div>
                        `}
                    </div>
                `;
            }).join('');
        }

        function changeFormation(formation) {
            currentFormation = formation;
            currentLineup = {};
            renderLineupEditor(document.getElementById('content'));
        }

        function openPlayerSelector(slotIdx, position) {
            selectedSlot = slotIdx;
            const modal = document.getElementById('playerModal');
            const teamPlayers = app.players.filter(p => p.team === app.team && p.position === position);
            
            const modalList = document.getElementById('modalPlayerList');
            modalList.innerHTML = teamPlayers.length === 0 ? 
                `<p style="color:#b0b0b0;">Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ Ø¯Ø± Ù¾Ø³Øª ${position} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>` :
                teamPlayers.map(p => {
                    const inLineup = Object.values(currentLineup).includes(p.id);
                    return `
                        <div class="player-item ${inLineup ? 'selected' : ''}" onclick="selectPlayer(${p.id})">
                            <div>
                                <strong>${p.name}</strong>
                                <span style="color:#b0b0b0; margin-left:10px;">${p.position}</span>
                            </div>
                            <div style="color:#1eff00; font-weight:700;">${p.overall}</div>
                        </div>
                    `;
                }).join('');
            
            modal.classList.add('show');
        }

        function selectPlayer(playerId) {
            if (selectedSlot !== null) {
                // Remove player from other slots if exists
                Object.keys(currentLineup).forEach(key => {
                    if (currentLineup[key] === playerId) {
                        delete currentLineup[key];
                    }
                });
                
                currentLineup[selectedSlot] = playerId;
                closeModal();
                renderLineupEditor(document.getElementById('content'));
            }
        }

        function closeModal() {
            document.getElementById('playerModal').classList.remove('show');
            selectedSlot = null;
        }

        function saveLineup() {
            app.lineups[app.team] = {
                formation: currentFormation,
                players: { ...currentLineup }
            };
            
            app.notifications.push({
                id: Date.now(),
                text: `ØªÛŒÙ… ${app.team} ØªØ±Ú©ÛŒØ¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ú†ÛŒÙ†Ø´ ${currentFormation} Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯`,
                time: new Date().toLocaleString('fa-IR')
            });
            
            saveData();
            alert('âœ… ØªØ±Ú©ÛŒØ¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
        }

        function clearLineup() {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ØªØ±Ú©ÛŒØ¨ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            currentLineup = {};
            renderLineupEditor(document.getElementById('content'));
        }

        function autoFillLineup() {
            const teamPlayers = app.players.filter(p => p.team === app.team);
            const slots = formations[currentFormation];
            
            currentLineup = {};
            
            slots.forEach((slot, idx) => {
                const availablePlayers = teamPlayers.filter(p => {
                    return p.position === slot.pos && !Object.values(currentLineup).includes(p.id);
                });
                
                if (availablePlayers.length > 0) {
                    // Sort by overall and pick the best
                    availablePlayers.sort((a, b) => b.overall - a.overall);
                    currentLineup[idx] = availablePlayers[0].id;
                }
            });
            
            renderLineupEditor(document.getElementById('content'));
            alert('ØªØ±Ú©ÛŒØ¨ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø± Ø´Ø¯!');
        }
    </script>
</body>
</html>
